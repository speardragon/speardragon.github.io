I"8Ò<h2 id="what-is-directory">What is Directory</h2>

<ul>
  <li>A kind of <strong>file</strong> used to organize
    <ul>
      <li>regular, pipe, special files and other directory <strong>as directory entries</strong>
        <ul>
          <li>directory entryë¡œ ê´€ë¦¬</li>
        </ul>
      </li>
      <li>format imposed by Unix/Linux</li>
    </ul>
  </li>
  <li><strong>file names</strong> are contained only in <strong>directory entries</strong>
    <ul>
      <li>i-ë…¸ë“œì—ëŠ” file ì´ë¦„ì´ ì—†ìŒ</li>
    </ul>
  </li>
  <li>permissions
    <ul>
      <li>r: readable</li>
      <li>w: writable</li>
      <li>x: searchable
        <ul>
          <li>íŒŒì¼ì—ì„œëŠ” ì‹¤í–‰ì´ ê²€ìƒ‰ ê°€ëŠ¥ìœ¼ë¡œ ëŒ€ì¹˜</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/162351770-e763fafc-47a9-4f1e-aa28-b6274963c47f.png" alt="image" /></p>

<p>directory entry -&gt; DIR êµ¬ì¡°ì²´</p>

<p><br /></p>

<h2 id="filedirectory-access-permissions">File/Directory access permissions</h2>

<p><span style="color:red">ì‹œí—˜ ë‚´ìš©</span></p>

<ul>
  <li>Read
    <ul>
      <li>file: file dataë¥¼ ì½ì„ ìˆ˜ ìˆëŠ”ê°€?(copy ê°€ëŠ¥?)</li>
      <li>Directory: file listë¥¼ readí•  ìˆ˜ ìˆëŠ”ê°€?(ls ê°€ëŠ¥?)</li>
    </ul>
  </li>
  <li>write
    <ul>
      <li>File: file dataë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ”ê°€?</li>
      <li>Directory: directoryì˜ fileì„ ìƒì„±, ì‚­ì œí•  ìˆ˜ ìˆëŠ”ê°€?
        <ul>
          <li><strong>Does not mean that we can write to the directory itself.</strong></li>
          <li>write() ì‹œìŠ¤í…œì½œì„ ì´ìš©í•´ ë””ë ‰í„°ë¦¬ ì—”íŠ¸ë¦¬ ìˆ˜ì •, ì¶”ê°€í•˜ëŠ” ê²ƒ <span style="color:red">ë¶ˆí—ˆ</span></li>
          <li>We <strong>need</strong> some <strong>APIs</strong> that can deal with directory itself.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>execute
    <ul>
      <li>File: fileì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”ê°€?</li>
      <li>Directory: ì´ë™í•  ìˆ˜ ìˆëŠ”ê°€?(cd ê°€ëŠ¥?)</li>
    </ul>
  </li>
  <li>ë””ë ‰í† ë¦¬ì— <strong>write</strong> ê¶Œí•œê³¼ <strong>execute</strong> ê¶Œí•œì´ ë™ì‹œì— ìˆì–´ì•¼ í•œë‹¤.
    <ul>
      <li>ê·¸ ë””ë ‰í† ë¦¬ì— íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ ìˆê³ </li>
      <li>ê·¸ ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ì„ ì‚­ì œí•  ìˆ˜ ìˆë‹¤</li>
    </ul>
  </li>
  <li><strong>ì‚­ì œí•  ë•ŒëŠ” ê·¸ íŒŒì¼ì— ëŒ€í•œ readê¶Œí•œì€ ì—†ì–´ë„ ë¨</strong> <strong>(ì‹œí—˜)</strong></li>
</ul>

<p><br /></p>

<h2 id="inodeì™€-directory-ê´€ê³„">Inodeì™€ directory ê´€ê³„</h2>

<p><span style="color:red">ì‹œí—˜</span></p>

<ul>
  <li>/home/obama/test.c</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/162352105-cbff72f0-2678-4835-95e1-008fcec01e5e.png" alt="image" /></p>

<ul>
  <li>
    <p>root directoryì˜ i-ë…¸ë“œë¥¼ ì°¾ì•„ê°„ë‹¤. -&gt; 2 (In Linux)</p>
  </li>
  <li>2ë²ˆ ë…¸ë“œë¥¼ ì°¾ì•„ê°€ë©´ ê·¸ê²ƒì´ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ i-ë…¸ë“œ ì´ë‹¤.
    <ul>
      <li>íŒŒì¼ì—ì„œëŠ” 0ë²ˆì´ì—ˆëŠ”ë° ë””ë ‰í† ë¦¬ì—ì„œëŠ” 2ë²ˆ ë…¸ë“œ</li>
    </ul>
  </li>
  <li>i-ë…¸ë“œì—ëŠ” UID, GID, Type, ê¶Œí•œ, <strong>ë¸”ë¡ í¬ì¸í„°</strong> ë“±ì´ ë“¤ì–´ìˆê³  ê·¸ ì¤‘ì—ì„œ ë¸”ë¡ í¬ì¸í„°ë¥¼ ë“¤ì–´ê°€ ë³´ë©´ ê·¸ê³³ì— directory entry (file name + i-node)ê°€ ì¡´ì¬í•œë‹¤.</li>
  <li>directory data blockì—ëŠ” ì ‘ê·¼ì„ ì›í•˜ëŠ” íŒŒì¼ì˜ i-ë…¸ë“œ ì •ë³´ê°€ ë‹´ê²¨ ìˆê³  ê·¸ i-ë…¸ë“œë¥¼ ì°¾ì•„ ë“¤ì–´ê°€ ê·¸ ì•ˆì˜ ë¸”ë¡í¬ì¸í„° ì •ë³´ë¥¼ ë³´ê³  ì´ëŸ¬í•œ ì¼ë ¨ì˜ ê³¼ì •ì„ ë°˜ë³µí•˜ì—¬ ì›í•˜ëŠ” ìœ„ì¹˜ì˜ data blockì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ë‹¤.</li>
</ul>

<p>ìœ„ì™€ ê°™ì€ ì¼ë ¨ì˜ ê³¼ì •ì„ ë°˜ë³µí•˜ì—¬ test.c íŒŒì¼ì˜ ë¸”ë¡ í¬ì¸í„°ë¥¼ ì°¾ì•„ê°ˆ ìˆ˜ ìˆê²Œëœë‹¤.</p>

<p><br /></p>

<h2 id="ë””ë ‰í„°ë¦¬-êµ¬í˜„">ë””ë ‰í„°ë¦¬ êµ¬í˜„</h2>

<ul>
  <li>ë””ë ‰í„°ë¦¬ ë‚´ì—ëŠ” ë¬´ì—‡ì´ ì €ì¥ë˜ì–´ ìˆì„ê¹Œ?
    <ul>
      <li>ë””ë ‰í„°ë¦¬ ì—”íŠ¸ë¦¬ë“¤(directory entry)</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="cp">
</span><span class="k">struct</span> <span class="n">dirent</span> <span class="p">{</span>
    <span class="n">ino_t</span> <span class="n">d_ino</span><span class="p">;</span> <span class="c1">// i-ë…¸ë“œ ë²ˆí˜¸</span>
    <span class="kt">char</span> <span class="n">d_name</span><span class="p">[</span><span class="n">NAME_MAX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">//íŒŒì¼ ì´ë¦„, null-terminated</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/79521972/162352280-8be44692-e58a-4b0e-a9d7-fec74d259f59.png" alt="image" /></p>

<p><br /></p>

<h2 id="open-directory">Open directory</h2>

<ul>
  <li>opendir()
    <ul>
      <li>ë””ë ‰í„°ë¦¬ ì—´ê¸° ìœ„í•œ í•¨ìˆ˜</li>
      <li>DIR í¬ì¸í„°(ì—´ë¦° ë””ë ‰í„°ë¦¬ë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°) ë¦¬í„´
        <ul>
          <li>ì¦‰, DIR êµ¬ì¡°ì²´ì˜ ì‹œì‘ ì£¼ì†Œë¥¼ ë¦¬í„´</li>
        </ul>
      </li>
      <li>DIR: ì—´ë¦° ë””ë ‰í† ë¦¬ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” êµ¬ì¡°ì²´
        <ul>
          <li>represents a <strong>directory stream</strong>(directory entryë“¤ì´ ë‚˜ì—´ëœ ê²ƒ)</li>
          <li>Defined in <dirent.h></dirent.h></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="cp">
</span><span class="kt">DIR</span> <span class="o">*</span><span class="nf">opendir</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">);</span>
<span class="c1">//path ë””ë ‰í„°ë¦¬ë¥¼ ì—´ê³  ì„±ê³µí•˜ë©´ DIR êµ¬ì¡°ì²´ í¬ì¸í„°ë¥¼, ì‹¤íŒ¨í•˜ë©´ NULLì„ ë¦¬í„´</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="read-directory">Read directory</h2>

<ul>
  <li>readdir()
    <ul>
      <li>ë””ë ‰í„°ë¦¬ ì½ê¸° í•¨ìˆ˜.</li>
      <li>í•˜ë‚˜ì˜ ë””ë ‰í„°ë¦¬ <strong>ì—”íŠ¸ë¦¬ ì •ë³´ ì½ìŒ</strong>, <mark>ì½ê¸°ê¶Œí•œ í•„ìš” </mark></li>
      <li>On the first call, the first directory entry is read into dirent.</li>
      <li>On completion, <strong>the directory pointer is moved</strong> onto the <strong>next entry</strong> in the directory.</li>
      <li>If the end of the directory is reached, NULL is returned.</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="cp">
</span><span class="k">struct</span> <span class="n">dirent</span> <span class="o">*</span><span class="nf">readdir</span><span class="p">(</span><span class="kt">DIR</span> <span class="o">*</span><span class="n">dp</span><span class="p">);</span>
 <span class="c1">//í•œ ë²ˆì— ë””ë ‰í„°ë¦¬ ì—”íŠ¸ë¦¬ë¥¼ í•˜ë‚˜ì”© ì½ì–´ì„œ ë¦¬í„´í•œë‹¤.</span>
 <span class="c1">//ë””ë ‰í† ë¦¬ì˜ current file positionì€ ì½ì„ ë•Œë§ˆë‹¤ ì½ì€ ë””ë ‰í„°ë¦¬ ì—”íŠ¸ë¦¬ (êµ¬ì¡°ì²´ dirent) í¬ê¸° ë§Œí¼ ì´ë™í•œë‹¤</span>

 <span class="c1">//Returns: pointer if OK, NULL at end of directory or error</span>
</code></pre></div></div>

<p>parameter: directory streamì˜ ì£¼ì†Œ</p>

<p>return: íŠ¹ì • directory entryì˜ ì£¼ì†Œ</p>

<p><br /></p>

<h2 id="close-directories">Close directories</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">closedir</span><span class="p">(</span><span class="kt">DIR</span> <span class="o">*</span><span class="n">dp</span><span class="p">);</span>
<span class="c1">// Returns: 0 if OK, -1 on error </span>
</code></pre></div></div>

<ul>
  <li>Open a directory / Close an open directory
    <ul>
      <li>DIR: represents a <strong>directory stream</strong>
        <ul>
          <li>Defined in <dirent.h></dirent.h></li>
          <li>Similar to FILE type in the standard I/O library.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>closedir()
    <ul>
      <li>ë””ë ‰í† ë¦¬ íŒŒì¼ì„ ë‹«ëŠ”ë‹¤.</li>
      <li>ë¦¬í„´ ê°’: ì„±ê³µí•˜ë©´ 0, ì‹¤íŒ¨í•˜ë©´ -1</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="rewind-directories">Rewind directories</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="cp">
</span>
<span class="kt">void</span> <span class="nf">rewinddir</span><span class="p">(</span><span class="kt">DIR</span> <span class="o">*</span><span class="n">dp</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>readdir() ì‹œìŠ¤í…œ ì½œë¡œ directory entryë¥¼ ì½ë‹¤ë³´ë©´ directory streamì„ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°ê°€ ê³„ì† ì´ë™í•  ê²ƒì¸ë° ì´ í¬ì¸í„°ë¥¼ ë‹¤ì‹œ ì²˜ìŒ ìœ„ì¹˜ë¡œ ë˜ëŒë¦¬ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” system call</li>
  <li>If you want to read from the beginning of directory, use rewinddir.
    <ul>
      <li>ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì½ê³  ì‹¶ì„ ë•Œ</li>
      <li>ë””ë ‰í† ë¦¬ íŒŒì¼ì˜ current file positionì„ ì²˜ìŒ (first entry of the directory) ìœ¼ë¡œ ì˜®ê¸´ë‹¤</li>
    </ul>
  </li>
</ul>

<hr />

<p>Q) êµ¬ì¡°ì²´ í¬ì¸í„°ë¥¼ ì“°ëŠ” ì´ìœ </p>

<p>A) í¬ì¸í„°ì™€ ì°¸ì¡°ëŠ” Call by Reference ìš©ë„ë¡œ ë§ì´ ì”ë‹ˆë‹¤. êµ¬ì¡°ì²´ë„ ë³„ë‹¤ë¥¼ ê²ƒ ì—†ì´ Call by Reference ë¡œ ê°’ì„ ì°¸ì¡°í•˜ëŠ”ê²Œ ë” íš¨ìœ¨ì ì¸ ê²½ìš°, í˜¹ì€ í•„ìš”í•œ ê²½ìš°ì— í¬ì¸í„°ì™€ ì°¸ì¡°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>

<p>ì¦‰, êµ¬ì¡°ì²´ì˜ ë©¤ë²„ ë³€ìˆ˜ì˜ ìˆ˜ì •ì„ ìš”í•  ë•Œ ì‚¬ìš©í•œë‹¤.</p>

<hr />

<p><br /></p>

<h2 id="reading-directoriesexample">Reading directories(example)</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="cp">
</span>
<span class="n">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">pathname</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span> 		<span class="c1">//ë¬¸ì ë°°ì—´ ì„ ì–¸</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> 		<span class="c1">//ì‹¤í–‰ íŒŒì¼ ì´ë¦„ë§Œ ì£¼ì–´ì§„ ê²½ìš°, input argumentê°€ ì—†ëŠ” ê²½ìš°</span>
    	<span class="n">strcpy</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="err">â€œ</span><span class="p">.</span><span class="err">â€</span><span class="p">);</span> <span class="c1">//ëŒ€ìƒ ê²½ë¡œë¥¼ í˜„ì¬ ë””ë ‰í† ë¦¬ë¡œ í•  ê²ƒì´ë‹¤.</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="err">â€œ</span><span class="n">Too</span> <span class="n">many</span> <span class="n">parameter</span><span class="err">â€¦\</span><span class="n">n</span><span class="err">â€</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="c1">//argc = 2</span>
    	<span class="n">strcpy</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">//ì¸ìë¥¼ pathname ë³€ìˆ˜ì— ì €ì¥</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">my_double_ls</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
    	<span class="n">printf</span><span class="p">(</span><span class="s">"Could not open the directory</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">my_double_ls</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">dirent</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
    <span class="kt">DIR</span> <span class="o">*</span><span class="n">dp</span><span class="p">;</span> <span class="c1">//ë””ë ‰í† ë¦¬ ìŠ¤íŠ¸ë¦¼ í¬ì¸í„°</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">dp</span> <span class="o">=</span> <span class="n">opendir</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="c1">//opendir() ì‹œìŠ¤í…œì½œ í˜¸ì¶œ</span>
    	<span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dp</span><span class="p">))</span> <span class="p">{</span> <span class="c1">//readdirì˜ í¬ì¸í„°ëŠ” ìë™ì„ ì´ë™í•œë‹¤.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">d_ino</span> <span class="o">!=</span><span class="mi">0</span><span class="p">)</span>
        	<span class="n">printf</span> <span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">rewinddir</span><span class="p">(</span><span class="n">dp</span><span class="p">);</span> <span class="c1">//ì²« directory entryë¡œ ì´ë™</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dp</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">d_ino</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        	<span class="n">printf</span> <span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="n">closedir</span><span class="p">(</span><span class="n">dp</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>ì‹¤í–‰</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls </span>temp_dir/
abc bookmark fred
<span class="nv">$ </span>./a.out temp_dir/
fred
abc
bookmark
..
<span class="nb">.</span>		//rewind ì´í›„
fred
abc
bookmark
..
<span class="nb">.</span>
<span class="err">$</span>
</code></pre></div></div>

<p>ì¶œë ¥ì— ë‚˜ì˜¤ëŠ” â€˜.â€™ê³¼ â€˜..â€™ì€ ê°ê° current directoryì™€ parent directoryë¥¼ ì˜ë¯¸í•œë‹¤.</p>

<p><br /></p>

<h2 id="reading-directories---list1c">Reading directories - list1.c</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="c1"> // primitive system data types</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="c1"> // file status</span><span class="cp">
#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="c1"> // directory entries</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="cm">/* ë””ë ‰í„°ë¦¬ ë‚´ì˜ íŒŒì¼ ì´ë¦„ë“¤ì„ ë¦¬ìŠ¤íŠ¸í•œë‹¤. */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">DIR</span> <span class="o">*</span><span class="n">dp</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">dir</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">dirent</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">stat</span> <span class="n">st</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">path</span><span class="p">[</span><span class="n">BUFSIZ</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    	<span class="n">dir</span> <span class="o">=</span> <span class="s">"."</span><span class="p">;</span> <span class="c1">// ì¸ìê°€ ì—†ëŠ” ê²½ìš° í˜„ì¬ ë””ë ‰í„°ë¦¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ</span>
    <span class="k">else</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">dp</span> <span class="o">=</span> <span class="n">opendir</span><span class="p">(</span><span class="n">dir</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="c1">// ë””ë ‰í„°ë¦¬ ì—´ê¸°</span>
    	<span class="n">perror</span><span class="p">(</span><span class="n">dir</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">((</span><span class="n">d</span> <span class="o">=</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dp</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="c1">// ê° ë””ë ‰í„°ë¦¬ ì—”íŠ¸ë¦¬ì— ëŒ€í•´</span>
    	<span class="n">printf</span><span class="p">(</span><span class="s">"%s </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span> <span class="c1">// íŒŒì¼ ì´ë¦„ í”„ë¦°íŠ¸</span>

    <span class="n">closedir</span><span class="p">(</span><span class="n">dp</span><span class="p">);</span> 
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> 
<span class="p">}</span> 
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>list1
 <span class="nb">.</span>
 ..
 file1
 file2
</code></pre></div></div>

<p><br /></p>

<h2 id="íŒŒì¼-ì´ë¦„í¬ê¸°-ì¶œë ¥">íŒŒì¼ ì´ë¦„/í¬ê¸° ì¶œë ¥</h2>

<ul>
  <li>ë””ë ‰í„°ë¦¬ ë‚´ì— ìˆëŠ” íŒŒì¼ ì´ë¦„ê³¼ í•´ë‹¹ íŒŒì¼ì˜ í¬ê¸°(ë¸”ë¡ì˜ ìˆ˜)ë¥¼ ì¶œë ¥í•˜ë„ë¡ í™•ì¥</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="p">((</span><span class="n">d</span> <span class="o">=</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dp</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span> 		<span class="c1">//ë””ë ‰í„°ë¦¬ ë‚´ì˜ ê° íŒŒì¼</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">"%s/%s"</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span> <span class="c1">// íŒŒì¼ê²½ë¡œëª… ë§Œë“¤ê¸° ;ex) home/etc</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lstat</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> 				<span class="c1">// íŒŒì¼ ìƒíƒœ ì •ë³´ stì— ê°€ì ¸ì˜¤ê¸°</span>
    	<span class="n">perror</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%5d %s"</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">st_blocks</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span> <span class="c1">// ë¸”ë¡ ìˆ˜, íŒŒì¼ ì´ë¦„ ì¶œë ¥</span>
    <span class="n">putchar</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="st_mode-êµ¬ì¡°ì²´">st_mode êµ¬ì¡°ì²´</h2>

<ul>
  <li>lstat() ì‹œìŠ¤í…œ í˜¸ì¶œ
    <ul>
      <li>íŒŒì¼ íƒ€ì…ê³¼ ì‚¬ìš©ê¶Œí•œ ì •ë³´ëŠ” st-&gt;st_mode í•„ë“œì— í•¨ê»˜ ì €ì¥ë¨.</li>
    </ul>
  </li>
  <li>st_mode í•„ë“œ
    <ul>
      <li>4ë¹„íŠ¸: íŒŒì¼ íƒ€ì…</li>
      <li>3ë¹„íŠ¸: íŠ¹ìˆ˜ìš©ë„</li>
      <li>9ë¹„íŠ¸: ì‚¬ìš©ê¶Œí•œ
        <ul>
          <li>3ë¹„íŠ¸: íŒŒì¼ ì†Œìœ ìì˜ ì‚¬ìš©ê¶Œí•œ</li>
          <li>3ë¹„íŠ¸: ê·¸ë£¹ì˜ ì‚¬ìš©ê¶Œí•œ</li>
          <li>3ë¹„íŠ¸: ê¸°íƒ€ ì‚¬ìš©ìì˜ ì‚¬ìš©ê¶Œí•œ</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/162353174-26f3ab1e-278d-4b11-9954-825cf99763b6.png" alt="image" /></p>

<p><br /></p>

<h2 id="ë””ë ‰í„°ë¦¬-ë¦¬ìŠ¤íŠ¸-ì˜ˆ">ë””ë ‰í„°ë¦¬ ë¦¬ìŠ¤íŠ¸: ì˜ˆ</h2>

<ul>
  <li>list2.c
    <ul>
      <li>ls â€“l ëª…ë ¹ì–´ì²˜ëŸ¼ íŒŒì¼ì˜ <strong>ëª¨ë“  ìƒíƒœ ì •ë³´</strong>ë¥¼ í”„ë¦°íŠ¸</li>
    </ul>
  </li>
  <li>í”„ë¡œê·¸ë¨ êµ¬ì„±(í•¨ìˆ˜ êµ¬ì„±)
    <ul>
      <li>main() : ë©”ì¸ í”„ë¡œê·¸ë¨</li>
      <li>printStat() : íŒŒì¼ ìƒíƒœ ì •ë³´ í”„ë¦°íŠ¸</li>
      <li>type() : íŒŒì¼ íƒ€ì… ë¦¬í„´</li>
      <li>perm() : íŒŒì¼ ì‚¬ìš©ê¶Œí•œ ë¦¬í„´</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h3 id="list2c">list2.c</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;dirent.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;pwd.h&gt;</span><span class="c1"> // password file</span><span class="cp">
#include</span> <span class="cpf">&lt;grp.h&gt;</span><span class="c1"> // group file (</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">char</span> <span class="nf">type</span><span class="p">(</span><span class="n">mode_t</span><span class="p">);</span> <span class="c1">// í•¨ìˆ˜ ì›í˜•</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">perm</span><span class="p">(</span><span class="n">mode_t</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">printStat</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span><span class="o">*</span><span class="p">);</span>

<span class="cm">/* ë””ë ‰í„°ë¦¬ ë‚´ìš©ì„ ìì„¸íˆ ë¦¬ìŠ¤íŠ¸í•œë‹¤. */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">DIR</span> <span class="o">*</span><span class="n">dp</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">dir</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">stat</span> <span class="n">st</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">dirent</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">path</span><span class="p">[</span><span class="n">BUFSIZ</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span> <span class="mi">103</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    	<span class="n">dir</span> <span class="o">=</span> <span class="s">"."</span><span class="p">;</span> <span class="c1">//current directoryë¥¼ ëŒ€ìƒìœ¼ë¡œ ì§€ì •</span>
    <span class="k">else</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">//ì¸ìê°’ì„ ëŒ€ìƒìœ¼ë¡œ ì§€ì •</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">dp</span> <span class="o">=</span> <span class="n">opendir</span><span class="p">(</span><span class="n">dir</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="c1">// ë””ë ‰í„°ë¦¬ ì—´ê¸°</span>
    	<span class="n">perror</span><span class="p">(</span><span class="n">dir</span><span class="p">);</span>

    <span class="c1">//list1.c ë¡œë¶€í„° ìˆ˜ì •ëœ ë¶€ë¶„!!!</span>
    <span class="k">while</span> <span class="p">((</span><span class="n">d</span> <span class="o">=</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dp</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ë””ë ‰í„°ë¦¬ì˜ ê° íŒŒì¼ì— ëŒ€í•´</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">"%s/%s"</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span> <span class="c1">// íŒŒì¼ê²½ë¡œëª… ë§Œë“¤ê¸°</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">lstat</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// íŒŒì¼ ìƒíƒœ ì •ë³´ ê°€ì ¸ì˜¤ê¸°</span>
        	<span class="n">perror</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        
        <span class="n">printStat</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">);</span> <span class="c1">// ìƒíƒœ ì •ë³´ ì¶œë ¥</span>
        <span class="n">putchar</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">closedir</span><span class="p">(</span><span class="n">dp</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* íŒŒì¼ ìƒíƒœ ì •ë³´ë¥¼ ì¶œë ¥ */</span>
<span class="kt">void</span> <span class="nf">printStat</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">pathname</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span> <span class="o">*</span><span class="n">st</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%5d "</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">st_blocks</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%c%s "</span><span class="p">,</span> <span class="n">type</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">st_mode</span><span class="p">),</span> <span class="n">perm</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">st_mode</span><span class="p">));</span> <span class="c1">//type:dë‚˜ - ê°™ì€ , perm:rwxê°™ì€</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%3d "</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">st_nlink</span><span class="p">);</span> <span class="c1">//ë§í¬ì˜ ê°¯ìˆ˜</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s %s "</span><span class="p">,</span> <span class="n">getpwuid</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">st_uid</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pw_name</span><span class="p">,</span> <span class="n">getgrgid</span><span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">st_gid</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">gr_name</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%9d "</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">st_size</span><span class="p">);</span> <span class="c1">//ë°”ì´íŠ¸ ë‹¨ìœ„ì˜ í¬ê¸°</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%.12s "</span><span class="p">,</span> <span class="n">ctime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">st_mtime</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span> <span class="c1">//ìš”ì¼ ì •ë³´ë¥¼ ë¹¼ê¸° ìœ„í•´ +4ë¥¼ í•˜ì˜€ìŒ</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* íŒŒì¼ íƒ€ì…ì„ ë¦¬í„´ by ë§¤í¬ë¡œí•¨ìˆ˜*/</span>
<span class="kt">char</span> <span class="nf">type</span><span class="p">(</span><span class="n">mode_t</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">S_ISREG</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="sc">'-'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">S_ISDIR</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="sc">'d'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">S_ISCHR</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="sc">'c'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">S_ISBLK</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="sc">'b'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">S_ISLNK</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="sc">'l'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">S_ISFIFO</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="sc">'p'</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">S_ISSOCK</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="sc">'s'</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* íŒŒì¼ ì‚¬ìš©ê¶Œí•œì„ ë¦¬í„´ */</span>
<span class="kt">char</span><span class="o">*</span> <span class="nf">perm</span><span class="p">(</span><span class="n">mode_t</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">char</span> <span class="n">perms</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s">"---------"</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">S_IRUSR</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">perms</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'r'</span><span class="p">;</span>  <span class="c1">//binary to character</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">S_IWUSR</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">perms</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'w'</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">S_IXUSR</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">perms</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'x'</span><span class="p">;</span>
    <span class="p">}</span>
    
	<span class="k">return</span><span class="p">(</span><span class="n">perms</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="char-permmode_t-mode-í•¨ìˆ˜">char *perm(mode_t mode) í•¨ìˆ˜</h3>

<ul>
  <li>
    <p>ì†Œìœ ìê°€ ì½ê¸° ê¶Œí•œì´ ìˆëŠ” ê²½ìš°</p>

    <p>0000 000 100 000 000   -&gt; 4+3+9</p>
  </li>
  <li>
    <p>S_IRUSR 00400</p>

    <p>0000 000 100 000 000</p>
  </li>
  <li>
    <p>mode &amp; (S_IRUSRÂ Â» i*3)</p>
    <ul>
      <li>0000 000 100 000 000 -&gt; mode</li>
      <li>0000 000 100 000 000 -&gt; S_IRUSR</li>
      <li>0000 000 001 000 000 -&gt; S_IRUSRÂ Â» i*3</li>
    </ul>
  </li>
</ul>

<p>ê·¸ë˜ì„œ  ì„œë¡œ í•´ë‹¹í•˜ëŠ” modeë¼ë¦¬ and ì—°ì‚°ì„ í†µí•˜ë©´ í•´ë‹¹ ìë¦¬ì—ëŠ” 1ì´ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— ì´ë¥¼ ì´ìš©í•œ ê²ƒì´ë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/79521972/162353174-26f3ab1e-278d-4b11-9954-825cf99763b6.png" alt="image" /></p>

<p><br /></p>

<h3 id="st_mode">st_mode</h3>

<ul>
  <li>permission bits/sys/stat.h</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define S_IRUSR 00400 </span><span class="cm">/* read permission: owner */</span><span class="cp">
#define S_IWUSR 00200 </span><span class="cm">/* write permission: owner */</span><span class="cp">
#define S_IXUSR 00100 </span><span class="cm">/* execute permission: owner */</span><span class="cp">
</span>
<span class="cp">#define S_IRGRP 00040 </span><span class="cm">/* read permission: group */</span><span class="cp">
#define S_IWGRP 00020 </span><span class="cm">/* write permission: group */</span><span class="cp">
#define S_IXGRP 00010 </span><span class="cm">/* execute permission: group */</span><span class="cp">
</span>
<span class="cp">#define S_IROTH 00004 </span><span class="cm">/* read permission: other */</span><span class="cp">
#define S_IWOTH 00002 </span><span class="cm">/* write permission: other */</span><span class="cp">
#define S_IXOTH 00001 </span><span class="cm">/* execute permission: other */</span><span class="cp">
</span></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$list2</span>
8 drw-r--r-- 2 chang faculty 4096 4ì›” 16ì¼ 13:37 <span class="nb">.</span>
8 drw-r--r-- 2 chang faculty 4096 3ì›” 26ì¼ 10:37 ..
2 <span class="nt">-rw-r--r--</span> 2 chang faculty 2088 4ì›” 16ì¼ 13:37 you.txt
2 <span class="nt">-rw-r--r--</span> 2 chang faculty 2088 4ì›” 16ì¼ 13:37 my.txt
</code></pre></div></div>

<p><br /></p>

<h3 id="getpwuid">getpwuid</h3>

<p>get password user id</p>

<ul>
  <li>ì‚¬ìš©ì idì™€ ì¼ì¹˜í•˜ëŠ” ì—”íŠ¸ë¦¬ë¥¼ /etc/pswd íŒŒì¼ì—ì„œ ì°¾ì•„ ê·¸ ì—”íŠ¸ë¦¬ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ ë°˜í™˜</li>
  <li>ì´ ì—”íŠ¸ë¦¬ì˜ pw_name í•„ë“œê°€ ì‚¬ìš©ì ì´ë¦„ì„ ê°€ì§€ê³  ìˆìŒ</li>
  <li>uidëŠ” integer ê°’</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;pwd.h&gt;</span><span class="cp">
</span><span class="k">struct</span> <span class="n">passwd</span> <span class="o">*</span><span class="nf">getpwuid</span><span class="p">(</span><span class="n">uid_t</span> <span class="n">uid</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">passwd</span><span class="p">{</span> 			<span class="cm">/* pwd.h */</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pw_name</span><span class="p">;</span> 		<span class="cm">/* Username. ê²°ê³¼ì ìœ¼ë¡œ ì´ê²ƒì„ ê°€ì ¸ì˜¤ê²Œ ë¨*/</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pw_passwd</span><span class="p">;</span> 	<span class="cm">/* Password. */</span>
    <span class="n">uid_t</span> <span class="n">pw_uid</span><span class="p">;</span> 		<span class="cm">/* User ID. ì´ê²ƒì„ í™•ì¸í•˜ì—¬ ì¼ì¹˜í•˜ë©´ ì´ êµ¬ì¡°ì²´ì˜ í¬ì¸í„°ë¥¼ ë°˜í™˜*/</span>
    <span class="n">gid_t</span> <span class="n">pw_gid</span><span class="p">;</span> 		<span class="cm">/* Group ID. */</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pw_gecos</span><span class="p">;</span> 	<span class="cm">/* Real name. */</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pw_dir</span><span class="p">;</span> 		<span class="cm">/* Home directory. */</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">pw_shell</span><span class="p">;</span> 	<span class="cm">/* Shell program. */</span>
<span class="p">};</span> 
</code></pre></div></div>

<p><br /></p>

<h3 id="getgrgid">getgrgid</h3>

<ul>
  <li>getgrgid: ê·¸ë£¹ idë¡œ ê·¸ë£¹ ì •ë³´ ì œê³µ</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;grp.h&gt;</span><span class="cp">
</span><span class="k">struct</span> <span class="n">group</span> <span class="o">*</span><span class="nf">getgrgid</span><span class="p">(</span><span class="n">gid_t</span> <span class="n">gid</span><span class="p">);</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="ctime">ctime()</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">utimbuf</span> <span class="p">{</span>
    <span class="kt">time_t</span> <span class="n">actime</span><span class="p">;</span> <span class="cm">/* access time */</span>
    <span class="kt">time_t</span> <span class="n">modtime</span><span class="p">;</span> <span class="cm">/* modification time */</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>char *ctime(const time_t *timep);</li>
  <li>ctime()
    <ul>
      <li>time_t íƒ€ì…ì˜ calendar timeì„ ë°›ì•„ â€œWen Nov 18 18:53:20â€ ê³¼ ê°™ì€ í˜•ì‹ì˜ ë¬¸ìì—´ì„ ë¦¬í„´</li>
    </ul>
  </li>
  <li>calendar timeì€1970-1-1 00:00 ë¶€í„° í˜„ì¬ê¹Œì§€ì˜ ê²½ê³¼ ì‹œê°„ì„ ì´ˆë¡œ í™˜ì‚°í•œ ê°’</li>
  <li>ì½”ë“œì—ì„œëŠ” (ìš”ì¼+ê³µë°±)ì„ ìƒëµí•˜ê³  í”„ë¦°íŠ¸í•˜ê¸°ìœ„í•´ +4ë¥¼ í•œ ê²ƒì„
    <ul>
      <li>ctime(&amp;st-&gt;st_mtime)+4);ë¡œ í˜¸ì¶œí•˜ì˜€ìŒ</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="ë””ë ‰í„°ë¦¬-ë§Œë“¤ê¸°">ë””ë ‰í„°ë¦¬ ë§Œë“¤ê¸°</h2>

<ul>
  <li>mkdir() ì‹œìŠ¤í…œ í˜¸ì¶œ
    <ul>
      <li>pathê°€ ë‚˜íƒ€ë‚´ëŠ” ìƒˆë¡œìš´ ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“ ë‹¤.</li>
      <li>â€.â€ì™€ â€œ..â€ íŒŒì¼ì€ ìë™ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤.
        <ul>
          <li>â€.â€ì€ ì´ ë””ë ‰í† ë¦¬ íŒŒì¼ì˜ i-nodeë¥¼,</li>
          <li>â€..â€ì€ ë¶€ëª¨ ë””ë ‰í† ë¦¬ íŒŒì¼ì˜ i-nodeë¥¼ ê°€ë¥´í‚¨ë‹¤</li>
        </ul>
      </li>
      <li>ë””ë ‰í„°ë¦¬ ì“°ê¸°ê¶Œí•œì´ ìˆì–´ë„ write í•¨ìˆ˜ë¡œ ì“¸ ìˆ˜ëŠ” ì—†ë‹¤.
        <ul>
          <li>mkdir, rmdir ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨(ê°„ì ‘ì ìœ¼ë¡œ)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">mkdir</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span><span class="p">);</span> <span class="c1">//ìœ„ì¹˜, permission ì •ë³´</span>
<span class="c1">//ìƒˆë¡œìš´ ë””ë ‰í„°ë¦¬ ë§Œë“¤ê¸°ì— ì„±ê³µí•˜ë©´ 0, ì‹¤íŒ¨í•˜ë©´ -1ì„ ë¦¬í„´í•œë‹¤.</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="ë””ë ‰í„°ë¦¬-ì‚­ì œ">ë””ë ‰í„°ë¦¬ ì‚­ì œ</h2>

<ul>
  <li>rmdir() ì‹œìŠ¤í…œ í˜¸ì¶œ
    <ul>
      <li>pathê°€ ë‚˜íƒ€ë‚´ëŠ” ë””ë ‰í„°ë¦¬ê°€ ë¹„ì–´ ìˆìœ¼ë©´ ì‚­ì œí•œë‹¤.</li>
      <li>An empty directory is one that contains entries <strong>only</strong> for <strong>dot</strong> and <strong>dot-dot</strong>.
        <ul>
          <li>ë””ë ‰í† ë¦¬ íŒŒì¼ì˜ link countë¥¼ ê°ì†Œ ì‹œí‚´</li>
          <li>link countê°€ 0ì´ ë˜ë©´ ì‚­ì œë¨(0ì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì€ ë˜ ë‹¤ë¥¸ entryê°€ ì¡´ì¬í•œë‹¤ëŠ” ê²ƒ)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">rmdir</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">);</span>
<span class="c1">//ë””ë ‰í„°ë¦¬ê°€ ë¹„ì–´ ìˆìœ¼ë©´ ì‚­ì œí•œë‹¤. ì„±ê³µí•˜ë©´ 0, ì‹¤íŒ¨í•˜ë©´ -1ì„ ë¦¬í„´</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="chdir-and-fchdir">chdir() and fchdir()</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">chdir</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pathname</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">fchdir</span><span class="p">(</span><span class="kt">int</span> <span class="n">filedes</span><span class="p">);</span>
<span class="c1">// Both return: 0 if OK, -1 on error </span>
</code></pre></div></div>

<ul>
  <li>Change the current working directory. (like â€˜cdâ€™)
    <ul>
      <li>Specify the new current working directory either as a pathname or file descriptor</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<ul>
  <li><strong>Example</strong></li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"apue.h"</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">chdir</span><span class="p">(</span><span class="s">"/tmp"</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    	<span class="n">err_sys</span><span class="p">(</span><span class="s">"chdir failed"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"chdir to /tmp succeeded</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">$ gcc -o mycd chdir.c</code></li>
</ul>

<p><br /></p>

<ul>
  <li><mark>**ì‹¤í–‰**</mark>(<span style="color:red">ì´ê±° ì¤‘ìš”</span>)</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">pwd</span>
/usr/lib
<span class="nv">$ </span>mycd
chdir to /tmp succeeded
<span class="nv">$ </span><span class="nb">pwd</span>
/usr/lib
<span class="err">$</span>
</code></pre></div></div>

<ul>
  <li>Current working directory of shell didnâ€™t change after mycd.</li>
  <li>Each program is run in a separate process
    <ul>
      <li>-&gt; current working directory of shell is <strong>unaffected</strong> by chdir in mycd.</li>
      <li><span style="color:blue">mycdë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ë³„ë„ì˜ mycdì˜ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— shell commandì˜ processì—ëŠ” ì˜í–¥ì„ ë¼ì¹˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤!!!</span></li>
      <li>ì‹¤í–‰ íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¤ë©´ shell commandì™€ëŠ” ë³„ë„ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë˜ì–´ ê·¸ ì•ˆì—ì„œ ë””ë ‰í† ë¦¬ë¥¼ ë°”ê¾¸ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì‹¤ì œ shell command ìƒì—ì„œëŠ” ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤.</li>
    </ul>
  </li>
  <li>Note that â€œcdâ€ is a <span style="color:red">built-in shell command!</span></li>
</ul>

<p>ì–´ì°Œ ë³´ë©´ ë‹¹ì—°í•œ ê±´ë° í—·ê°ˆë¦´ ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ë‹¤.</p>

<p><br /></p>

<h2 id="getcwd">getcwd()</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">getcwd</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
<span class="c1">//Returns: buf if OK, NULL on error</span>
</code></pre></div></div>

<ul>
  <li>Obtain the current working directory.
    <ul>
      <li>Copies an <strong>absolute pathname</strong> of the current working directory to the array pointed to by <em>buf</em> of length, <em>size</em>.</li>
      <li>size must be large enough to accommodate
        <ul>
          <li>the absolute pathname + a terminating null byte(â€˜/0â€™)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><br /></p>

<ul>
  <li><strong>example</strong></li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#define SIZE 200
</span><span class="kt">void</span> <span class="nf">my_pwd</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">my_pwd</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">my_pwd</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">dirname</span><span class="p">[</span><span class="n">SIZE</span><span class="p">];</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">getcwd</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">SIZE</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">"getcwd error"</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">dirname</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li><strong>ì‹¤í–‰</strong></li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./a.out
/home/obama/test
<span class="err">$</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="ë””ë ‰í„°ë¦¬-êµ¬í˜„-1">ë””ë ‰í„°ë¦¬ êµ¬í˜„</h2>

<ul>
  <li>ê·¸ë¦¼ 5.1ì˜ íŒŒì¼ ì‹œìŠ¤í…œ êµ¬ì¡°ë¥¼ ë³´ì.
    <ul>
      <li>ë””ë ‰í„°ë¦¬ë¥¼ ìœ„í•œ êµ¬ì¡°ëŠ” ë”°ë¡œ ì—†ë‹¤.</li>
    </ul>
  </li>
  <li>íŒŒì¼ ì‹œìŠ¤í…œ ë‚´ì—ì„œ ë””ë ‰í„°ë¦¬ë¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì„ê¹Œ?
    <ul>
      <li>ë””ë ‰í„°ë¦¬ë„ ì¼ì¢…ì˜ íŒŒì¼ë¡œ ë‹¤ë¥¸ íŒŒì¼ì²˜ëŸ¼ êµ¬í˜„ëœë‹¤.</li>
      <li>ë””ë ‰í„°ë¦¬ë„ ë‹¤ë¥¸ íŒŒì¼ì²˜ëŸ¼ í•˜ë‚˜ì˜ i-ë…¸ë“œë¡œ í‘œí˜„ëœë‹¤.</li>
      <li>ë””ë ‰í„°ë¦¬ì˜ ë‚´ìš©ì€ ë””ë ‰í„°ë¦¬ ì—”íŠ¸ë¦¬(íŒŒì¼ì´ë¦„, i-ë…¸ë“œ ë²ˆí˜¸)</li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/162354595-990e76ad-bdcb-42d7-96a6-4060347186c7.png" alt="image" /></p>

<p>2ë²ˆì—ëŠ” /(root directory)ì˜ ì •ë³´ê°€ ë‹´ê²¨ì ¸ ìˆë‹¤.</p>

<p>ê·¸ëŸ° ë‹¤ìŒ 4ë²ˆ ë…¸ë“œë¥¼ ì°¾ì•„ê°€ë©´ usrì˜ i-ë…¸ë“œ ì •ë³´ê°€ ìˆëŠ”ë° ë¸”ë¡í¬ì¸í„°ë¥¼ ë³´ê³  202ë²ˆ ë¸”ë½ ë²ˆí˜¸ì˜ ë‚´ìš©ìœ¼ë¡œ ë“¤ì–´ê°€ test.cì˜ i-ë…¸ë“œ ë²ˆí˜¸ì¸ 6ë²ˆì„ ë˜ íƒ€ê³  ë“¤ì–´ê°€ 204ë²ˆ ë¸”ëŸ­ì„ ì°¾ì•„ ë“¤ì–´ê°„ë‹¤.</p>

<p>directory entryëŠ” fileì¼ ìˆ˜ë„ directoryì¼ ìˆ˜ë„ ìˆë‹¤.</p>

:ET