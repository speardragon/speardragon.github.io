I"ÄG<h1 id="41-ì‹œìŠ¤í…œ-í˜¸ì¶œ">4.1 ì‹œìŠ¤í…œ í˜¸ì¶œ</h1>

<hr />

<h2 id="ëŒ€ë©´-ìˆ˜ì—…">ëŒ€ë©´ ìˆ˜ì—…</h2>

<p>í•˜ë“œë””ìŠ¤í¬ì— íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ê²ƒì„ ë°°ì›€</p>

<p><strong>ì‹œìŠ¤í…œ í˜¸ì¶œ</strong></p>

<p>ì‘ìš©í”„ë¡œê·¸ë¨ì—ì„œ ë­”ê°€ í•˜ë“œì›¨ì–´ì™€ ê´€ë ¨ëœ ì¼ì„ í•˜ê³  ì‹¶ì€ë° ë‚´ê°€ í•  ìˆ˜ê°€ ì—†ìœ¼ë‹ˆê¹Œ OSí•œí…Œ ìš”êµ¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.</p>

<p>a.out : program definition</p>

<p>í”„ë¡œì„¸ìŠ¤ë„ ì‚¬ì‹¤ìƒ ê°€ìƒí™”</p>

<p>OS</p>

<ol>
  <li>Convinience: to user</li>
  <li>Efficiency: to itself</li>
</ol>

<hr />

<h2 id="ì»´í“¨í„°-ì‹œìŠ¤í…œ-êµ¬ì¡°">ì»´í“¨í„° ì‹œìŠ¤í…œ êµ¬ì¡°</h2>

<ul>
  <li>ìœ ë‹‰ìŠ¤ ì»¤ë„(kernel)
    <ul>
      <li>í•˜ë“œì›¨ì–´ ìœ„ì— íƒ‘ì¬ëœ ì†Œí”„íŠ¸ì›¨ì–´(kernel)</li>
      <li><strong>í•˜ë“œì›¨ì–´ë¥¼ ìš´ì˜ ê´€ë¦¬(efficiency)</strong>í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ <strong>ì„œë¹„ìŠ¤ë¥¼ ì‘ìš© í”„ë¡œê·¸ë¨ì—ê²Œ ì œê³µ(convenient)</strong>
        <ul>
          <li>ì¦‰, ìì›ì„ ê´€ë¦¬</li>
        </ul>
      </li>
      <li>íŒŒì¼ ê´€ë¦¬ (File management)</li>
      <li>í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬(Memory mangement)</li>
      <li>í†µì‹  ê´€ë¦¬(Communication management)</li>
      <li>ì£¼ë³€ ì¥ì¹˜ ê´€ë¦¬(Device management)</li>
      <li>ì‘ìš© í”„ë¡œê·¸ë¨ì—ê²Œ ì„œë¹„ìŠ¤ ì œê³µ</li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160031305-ed2c70cf-47d6-4d3d-a36f-f8c0a8ce7324.png" alt="image" /></p>

<p>OSê°€ <code class="language-plaintext highlighter-rouge">CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬, ì£¼ë³€ ì¥ì¹˜</code>ì™€ ê°™ì€ í•˜ë“œì›¨ì–´ë¥¼ ì¶”ìƒí™”(abstraction) í•˜ì—¬ ì‘ìš©í”„ë¡œê·¸ë¨í•œí…Œ ì œê³µí•œë‹¤.</p>

<p><br /></p>

<h2 id="ì €ìˆ˜ì¤€-íŒŒì¼-ì…ì¶œë ¥ê³¼-ê³ ìˆ˜ì¤€-íŒŒì¼-ì…ì¶œë ¥">ì €ìˆ˜ì¤€ íŒŒì¼ ì…ì¶œë ¥ê³¼ ê³ ìˆ˜ì¤€ íŒŒì¼ ì…ì¶œë ¥</h2>

<p>OSì—ì„œëŠ” ë‘ ê°€ì§€ì˜ íŒŒì¼ ì…ì¶œë ¥ì„ ì œê³µí•œë‹¤.</p>

<p>ì…ì¶œë ¥ ìš”êµ¬ë¥¼ ì–´ë””ì„œ í•˜ëƒì— ë”°ë¼ ë‚˜ë‰˜ì–´ ì§€ëŠ” ê²ƒì´ì§€ íš¨ê³¼ëŠ” ë˜‘ê°™ë‹¤.</p>

<ul>
  <li><strong>ì €ìˆ˜ì¤€ íŒŒì¼ ì…ì¶œë ¥</strong>
    <ul>
      <li>ìœ ë‹‰ìŠ¤,ë¦¬ëˆ…ìŠ¤ê°€ ì œê³µí•˜ëŠ” ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²ƒ (OS ì»¤ë„ì— ë” ê°€ê¹ê²Œ)</li>
      <li>ë” ë‚®ì€ ê³³ì— ìˆì–´ì„œ ì €ìˆ˜ì¤€ì„</li>
      <li>ë” ì–´ë ¤ì›€</li>
      <li>ìœ ë‹‰ìŠ¤ ì»¤ë„ì˜ ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ì…ì¶œë ¥ì„ ì‹¤í–‰í•˜ë©°, íŠ¹ìˆ˜ íŒŒì¼ë„ ì½ê³  ì“¸ ìˆ˜ ìˆë‹¤.</li>
      <li>int fd = open (const char *path, int oflag, [ mode_t mode ]);
        <ul>
          <li>ë¦¬í„´ê°’: file descriptor</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>ê³ ìˆ˜ì¤€ íŒŒì¼ ì…ì¶œë ¥</strong>
    <ul>
      <li>ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë¶€ë‹´ìŠ¤ëŸ¬ìš´ ì‚¬ëŒì„ ìœ„í•´
        <ul>
          <li>ì»¤ë„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì»¤ë„ ì»´íŒŒì¼ê¹Œì§€ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ë¶€ë‹´ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆë‹¤.</li>
        </ul>
      </li>
      <li><strong>í‘œì¤€ ì…ì¶œë ¥ ë¼ì´ë¸ŒëŸ¬ë¦¬</strong>ë¡œ ë‹¤ì–‘í•œ í˜•íƒœì˜ íŒŒì¼ ì…ì¶œë ¥ í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤. (ìœ ë‹‰ìŠ¤ ì»¤ë„ì˜ ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)</li>
      <li>FILE *fopen(const char *name, const char *mode)
        <ul>
          <li>return: file êµ¬ì¡°ì²´</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="ì‹œìŠ¤í…œ-í˜¸ì¶œ">ì‹œìŠ¤í…œ í˜¸ì¶œ</h2>

<ul>
  <li>ì‹œìŠ¤í…œ í˜¸ì¶œì€ ì»¤ë„ì— ì„œë¹„ìŠ¤ ìš”ì²­ì„ ìœ„í•œ í”„ë¡œê·¸ë˜ë° <strong>ì¸í„°í˜ì´ìŠ¤</strong>.</li>
  <li>ì‘ìš© í”„ë¡œê·¸ë¨ì€ ì‹œìŠ¤í…œ í˜¸ì¶œì„ í†µí•´ì„œ ì»¤ë„ì— ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•œë‹¤.</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160031553-e2711aa0-15d5-42cc-995b-d8f66f1ab96a.png" alt="image" /></p>

<ul>
  <li>
    <p>ì‘ìš© í”„ë¡œê·¸ë¨ì€ ì»¤ë„ì—ê²Œ ì„œë¹„ìŠ¤ ìš”ì²­ì„ ì§ì ‘ì ìœ¼ë¡œ í•  ìˆ˜ë„ ìˆë‹¤.</p>
  </li>
  <li>ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ëŒ€í–‰ì„ í•´ ì¤€ë‹¤.</li>
  <li>ê²°ê³¼ì ìœ¼ë¡œëŠ” ê°™ì§€ë§Œ ì‘ìš©í”„ë¡œê·¸ë¨ì´ ì‹œìŠ¤í…œ í˜¸ì¶œì„ <strong>ì§ì ‘ì </strong>ìœ¼ë¡œ í•˜ëƒ <strong>ê°„ì ‘ì </strong>ìœ¼ë¡œ í•˜ëŠëƒê°€ ë‹¤ë¥¸ ê²ƒì´ë‹¤.</li>
</ul>

<p><br /></p>

<h2 id="ì‹œìŠ¤í…œ-í˜¸ì¶œê³¼-ë¼ì´ë¸ŒëŸ¬ë¦¬-í•¨ìˆ˜ì˜-ë¹„êµì‹œí—˜">ì‹œìŠ¤í…œ í˜¸ì¶œê³¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ì˜ ë¹„êµ<strong>(ì‹œí—˜)</strong></h2>

<ul>
  <li>ì‹œìŠ¤í…œ í˜¸ì¶œ: ì»¤ë„ì˜ í•´ë‹¹ ì„œë¹„ìŠ¤ ëª¨ë“ˆì„ ì§ì ‘ í˜¸ì¶œí•˜ì—¬ ì‘ì—…í•˜ê³  ê²°ê³¼ë¥¼ ë¦¬í„´</li>
  <li>ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜: ì¼ë°˜ì ìœ¼ë¡œ ì»¤ë„ ëª¨ë“ˆì„ ì§ì ‘ í˜¸ì¶œ ì•ˆ í•¨</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160031821-9eef6823-45fd-4fce-9a1a-9aa2200bff20.png" alt="image" /></p>

<ul>
  <li>
    <p>ì‘ìš©í”„ë¡œê·¸ë¨ì´ ì§ì ‘ ì‹œìŠ¤í…œ í˜¸ì¶œì„ í•˜ëŠ” ê²½ìš°, ì˜ì—­ ë³€í™˜ì— í•„ìš”í•œ ì¤€ë¹„ë¥¼ ì‹œìŠ¤í…œ í˜¸ì¶œ ì½”ë“œê°€ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ë‹¤.</p>
  </li>
  <li>ë°˜ë©´ ì‘ìš©í”„ë¡œê·¸ë¨ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš° mainí•¨ìˆ˜ì—ì„œ íŠ¹ì • ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¥¼ í†µí•´ ì‹œìŠ¤í…œ í˜¸ì¶œ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²½ìš° í•´ë‹¹ í•¨ìˆ˜ ì•ˆì— ì‹œìŠ¤í…œ í˜¸ì¶œ ì½”ë“œê°€ ìˆëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì‹œìŠ¤í…œ í˜¸ì¶œì´ ì¢…ë£Œ ë˜ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¡œ ëŒì•„ì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ê°€ ì¢…ë£Œë˜ë©´ mainí•¨ìˆ˜ë¡œ ëŒì•„ì˜¤ëŠ” ê²ƒì´ ê³¼ì •ì´ë¼ë©´</li>
  <li>mainí•¨ìˆ˜ì—ì„œ ì§ì ‘ ì‹œìŠ¤í…œ í˜¸ì¶œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ê²½ìš° ì‚¬ìš©ì ì˜ì—­ì—ì„œ ì»¤ë„ ì˜ì—­ìœ¼ë¡œ ë³€í™˜ í›„ ì»¤ë„ì´ ì¢…ë£Œë˜ë©´ ë‹¤ì‹œ ì‚¬ìš©ì ì˜ì—­ìœ¼ë¡œ ëŒì•„ì˜¨ë‹¤.</li>
</ul>

<p><br /></p>

<p>ì–´ë–¤ CPUë“ ì§€ ìœ ì €/ì»¤ë„ ëª¨ë“œë¥¼ ì œê³µí•¨.(íŠ¹ê¶Œì˜ ì°¨ì´)</p>

<p>ìœ ì € ëª¨ë“œë³´ë‹¤ ì»¤ë„ ëª¨ë“œì—ì„œ ë” í—ˆìš©ë˜ëŠ” ê²ƒì´ ë§ë‹¤. ì¦‰, ìœ ì € ëª¨ë“œì—ì„œ ëŒì•„ê°€ì§€ ì•ŠëŠ” ê²ƒì´ ì»¤ë„ ëª¨ë“œì—ì„œ ëŒì•„ê°€ëŠ” ê²½ìš°ê°€ ìˆë‹¤.</p>

<p>ë©€í‹° í”„ë¡œê·¸ë˜ë°ì´ ë  ìˆ˜ ìˆë„ë¡ ì»¤ë„ì´ ë„ì™€ì£¼ëŠ” ê²ƒ</p>

<p><br /></p>

<p>í•¨ìˆ˜ í˜¸ì¶œì„ í•  ë•Œ</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

<span class="p">}</span>

<span class="n">a</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>ì‹œìŠ¤í…œ ì½œì€ ì»¤ë„ ëª…ë ¹ì–´ì´ê¸° ë•Œë¬¸ì— stackì„ í†µí•´ì„œ ì „ë‹¬í•  ìˆ˜ ì—†ê³  CPU registerì— ì˜í•´ì„œ ì „ë‹¬í•œë‹¤</p>

<p><br /></p>

<h4 id="ì‹œìŠ¤í…œ-í˜¸ì¶œ-ê³¼ì •">ì‹œìŠ¤í…œ í˜¸ì¶œ ê³¼ì •</h4>

<p><img src="https://user-images.githubusercontent.com/79521972/160032207-fb3f91fe-d06c-489b-bf54-64497d052afa.png" alt="image" /></p>

<ul>
  <li>
    <p>fd: file descriptorì˜ ì•½ì</p>
  </li>
  <li>CPUëŠ” ì™¸ë¶€ì—ì„œ ëˆ„ê°€ interruptë¥¼ ê±´ ì§€ ì•Œê¸° ìœ„í•´ì„œ</li>
  <li>system call ê°™ì€ ê²½ìš°ëŠ” ìŠ¤íƒìœ¼ë¡œ ì¸ìë¥¼ ì „ë‹¬í•  ìˆ˜ ì—†ë‹¤.
    <ul>
      <li>í˜¸ì¶œí•˜ëŠ” ì˜ì—­ì€ ì‚¬ìš©ì ì˜ì—­ì´ì§€ë§Œ í˜¸ì¶œë˜ëŠ” ì˜ì—­ì€ ì»¤ë„ ì˜ì—­ì´ê¸° ë•Œë¬¸ì— ìŠ¤íƒì„ ê³µìœ í•˜ì§€ ì•ŠëŠ”ë‹¤.</li>
    </ul>
  </li>
  <li>ê·¸ë˜ì„œ CPU ë ˆì§€ìŠ¤í„°ë¡œ ë§¤ê°œë³€ìˆ˜ë¥¼ ì „ë‹¬í•˜ê²Œ ëœë‹¤.</li>
</ul>

<p><br /></p>

<h3 id="ì‹œìŠ¤í…œ-í˜¸ì¶œ-ìš”ì•½">ì‹œìŠ¤í…œ í˜¸ì¶œ ìš”ì•½</h3>

<p><img src="https://user-images.githubusercontent.com/79521972/160034362-fc9b0e08-9005-4bd5-b063-428911592116.png" alt="image" /></p>

<p><br /></p>

<h1 id="42-íŒŒì¼">4.2 íŒŒì¼</h1>

<h2 id="ì´-ì¥ì˜-ê¸°ë³¸-ë‚´ìš©">ì´ ì¥ì˜ ê¸°ë³¸ ë‚´ìš©</h2>

<p>íŒŒì¼ì´ ëª¨ì—¬ìˆëŠ” ê²ƒì´ íŒŒì¼ ì‹œìŠ¤í…œ.</p>

<p>ì´ë¥¼ ì˜ ì°¾ê¸° ìœ„í•´ì„œ ì‹œìŠ¤í…œì´ ì˜ ì •ë¦¬ê°€ ë˜ì–´ìˆì–´ì•¼ í•œë‹¤.</p>

<ul>
  <li>Processê°€ fileì„ ì‚¬ìš©í•˜ë ¤ë©´?
    <ul>
      <li>File systemì—ì„œ fileì˜ ìœ„ì¹˜ë¥¼ ì°¾ëŠ”ë‹¤. -&gt; open()</li>
      <li>Fileì˜ dataë¥¼ ì½ê±°ë‚˜ ì“´ë‹¤. -&gt; read()/write()</li>
      <li>Fileì˜ ì‚¬ìš©ì„ ë§ˆì¹œë‹¤. -&gt; close()</li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/162558132-6beac55f-76e7-401d-a40e-2c72f85195a4.png" alt="image" /></p>

<p><br /></p>

<h2 id="ìœ ë‹‰ìŠ¤ì—ì„œ-íŒŒì¼">ìœ ë‹‰ìŠ¤ì—ì„œ íŒŒì¼</h2>

<ul>
  <li>ì—°ì†ëœ ë°”ì´íŠ¸ì˜ ë‚˜ì—´</li>
  <li>íŠ¹ë³„í•œ ë‹¤ë¥¸ <strong>í¬ë§·ì„ ì •í•˜ì§€ ì•ŠìŒ</strong>(ë°ì´í„°ì˜ ì¢…ë¥˜ê°€ ë¬´ì—‡ì¸ì§€ êµ¬ë¶„í•˜ì§€ ì•ŠëŠ”ë‹¤.)
    <ul>
      <li>ì–´ë””ì„œë¶€í„° ì–´ë””ê¹Œì§€ëŠ” integerë§Œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê³ â€¦ ì´ëŸ° ê²ƒë“¤ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒ</li>
    </ul>
  </li>
  <li>ë””ìŠ¤í¬ íŒŒì¼ë¿ë§Œ ì•„ë‹ˆë¼ <strong>ì™¸ë¶€ ì¥ì¹˜</strong>ì— ëŒ€í•œ ì¸í„°í˜ì´ìŠ¤
    <ul>
      <li>ì™¸ë¶€ ì¥ì¹˜(í‚¤ë³´ë“œ)ë„ special fileë¡œ ê°„ì£¼í•˜ì—¬ byte sequneceê°€ ì»´í“¨í„°ë¡œ ì½í˜€ ë“¤ì–´ì˜¨ë‹¤.</li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160037209-0f7937a7-4ea5-4421-a74a-5acd0ff63aa9.png" alt="image" /></p>

<p><br /></p>

<h2 id="íŒŒì¼-ì—´ê¸°open">íŒŒì¼ ì—´ê¸°:open()</h2>

<ul>
  <li>
    <p>íŒŒì¼ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë¨¼ì € open() ì‹œìŠ¤í…œ í˜¸ì¶œì„ ì´ìš©í•˜ì—¬ íŒŒì¼ì„ ì—´ì–´ì•¼ í•œë‹¤.</p>
  </li>
  <li>
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="c1"> //defines Various data types used elsewhere(ë°ì´í„° íƒ€ì… ì •ì˜)</span><span class="cp">
#inlcude &lt;sys/stat.h&gt;  // File information (stat et al.) (íŒŒì¼ ì •ë³´)
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="c1">     // File opening, locking and other operations</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">open</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflag</span><span class="p">,</span> <span class="p">[</span><span class="n">mode_t</span> <span class="n">mode</span><span class="p">]);</span>
<span class="c1">// íŒŒì¼ ì—´ê¸°ì— ì„±ê³µí•˜ë©´ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ ë°˜í™˜, ì‹¤íŒ¨í•˜ë©´ -1ì„ ë°˜í™˜í•œë‹¤.</span>
</code></pre></div>    </div>

    <ul>
      <li>ëª‡ ê°€ì§€ í—¤ë”íŒŒì¼ì´ í¬í•¨ë˜ì–´ì•¼ í•¨</li>
    </ul>
  </li>
  <li>
    <p>return: íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ëŠ” <strong>ì—´ë¦° íŒŒì¼</strong>ì„ ë‚˜íƒ€ë‚´ëŠ” ë²ˆí˜¸ì´ë‹¤.</p>
  </li>
  <li>path: íŒŒì¼ì˜ ê²½ë¡œëª…</li>
  <li>oflag: íŒŒì¼ì„ ì—´ì–´ì„œ ì–´ë–¤ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•  ê²ƒ ì¸ì§€ë¥¼ ëª…ì‹œí•˜ëŠ” ë³€ìˆ˜</li>
  <li>mode: íŒŒì¼ì˜ access permission ê°’, ìƒˆë¡œìš´ íŒŒì¼ì„ ë§Œë“œëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš©ë¨.
    <ul>
      <li>ê¸°ì¡´ íŒŒì¼ì„ ì—¬ëŠ” ê²½ìš°ì—ëŠ” ì´ parameterê°€ ì˜ë¯¸ê°€ ì—†ë‹¤.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h4 id="oflag">Oflag</h4>

<ul>
  <li>íŒŒì¼ì„ ì˜¤í”ˆ í•  ë•Œ ë¬´ìŠ¨ ëª©ì ìœ¼ë¡œ ì—´ ê²ƒì¸ê°€</li>
  <li>Access mode (<mark>One of three constants must be specified.</mark>) ; ì•„ë˜ ì…‹ ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ëª…ì‹œ
    <ul>
      <li>O_RDONLY
        <ul>
          <li>ì½ê¸° ëª¨ë“œ, read() í˜¸ì¶œì€ ì‚¬ìš© ê°€ëŠ¥</li>
        </ul>
      </li>
      <li>O_WRONLY
        <ul>
          <li>ì“°ê¸° ëª¨ë“œ, write() í˜¸ì¶œì€ ì‚¬ìš© ê°€ëŠ¥</li>
        </ul>
      </li>
      <li>O_RDWR
        <ul>
          <li>ì½ê¸°/ì“°ê¸° ëª¨ë“œ, read(), write() í˜¸ì¶œ ì‚¬ìš© ê°€ëŠ¥</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>The followings are <strong>optional</strong>.
    <ul>
      <li>O_APPEND
        <ul>
          <li>ë°ì´í„°ë¥¼ ì“°ë©´ íŒŒì¼ ëì— ì´ì–´ì„œ ì²¨ë¶€ëœë‹¤.</li>
        </ul>
      </li>
      <li>O_CREAT
        <ul>
          <li>í•´ë‹¹ íŒŒì¼ì´ ì—†ëŠ” ê²½ìš°ì— ìƒˆë¡œ ìƒì„±í•˜ë©° modeëŠ” ìƒì„±í•  íŒŒì¼ì˜ ì‚¬ìš© ê¶Œí•œì„ ë‚˜íƒ€ë‚¸ë‹¤.</li>
          <li>ì´ê±¸ ì•ˆ ì“°ë©´ -1ì„ ë¦¬í„´í•˜ê³  íŒŒì¼ì„ ìƒì„± í•˜ì§€ë„ ì•ŠëŠ”ë‹¤.</li>
        </ul>
      </li>
      <li>O_TRUNC
        <ul>
          <li>íŒŒì¼ì´ ì´ë¯¸ ìˆëŠ” ê²½ìš° ë‚´ìš©ì„ ì§€ìš´ë‹¤.(ìƒˆë¡œìš´ íŒŒì¼ì„ ì—¬ëŠ” ê²ƒê³¼ ê°™ì€ íš¨ê³¼)</li>
        </ul>
      </li>
      <li>O_EXCL
        <ul>
          <li>O_CREATì™€ í•¨ê»˜ ì‚¬ìš©ë˜ë©° í•´ë‹¹ íŒŒì¼ì´ ì´ë¯¸ ìˆìœ¼ë©´ ì˜¤ë¥˜ë¥¼ ë°˜í™˜</li>
        </ul>
      </li>
      <li>O_NONBLOCK
        <ul>
          <li>ë„Œë¸”ë¡œí‚¹ ëª¨ë“œë¡œ ì…ì¶œë ¥ í•˜ë„ë¡ í•œë‹¤.</li>
          <li>ë„Œë¸”ë¡ì€ ë””ìŠ¤í¬ì— ë‚´ìš©ì´ ë‹¤ ì“°ì—¬ì§€ì§€ ì•Šì•„ë„ ë°”ë¡œ ë¦¬í„´ì´ ê°€ëŠ¥í•˜ë‹¤.</li>
        </ul>
      </li>
      <li>O_SYNC
        <ul>
          <li>write() ì‹œìŠ¤í…œì„ í˜¸ì¶œì„ í•˜ë©´ ë°˜ë“œì‹œ ë””ìŠ¤í¬ì— ë¬¼ë¦¬ì ìœ¼ë¡œ ì“´ í›„ì—ì•¼ ë°˜í™˜ëœë‹¤.
            <ul>
              <li>Any writes on the resulting file descriptor will block the calling process until the data has been physically written to the underlying hardware.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>nonblockì€ ë””ìŠ¤í¬ì—  ë¬¼ë¦¬ì ìœ¼ë¡œ ë‹¤ ì“°ì§€ ì•Šì•„ë„ ë°˜í™˜ì´ ë˜ì§€ë§Œ syncëŠ” ë°˜ë“œì‹œ ë‹¤ ì“´ í›„ì— ë°˜í™˜ëœë‹¤.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="íŒŒì¼-ì—´ê¸°-ì˜ˆ">íŒŒì¼ ì—´ê¸°: ì˜ˆ</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"account"</span><span class="p">,</span><span class="n">O_RDONLY</span><span class="p">);</span> <span class="c1">//current directoryì— ì¡´ì¬í•˜ëŠ” íŒŒì¼</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_RDWR</span><span class="p">);</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_RDWR</span> <span class="o">|</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0600</span><span class="p">);</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"tmpfile"</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="o">|</span><span class="n">O_CREAT</span><span class="o">|</span><span class="n">O_TRUNC</span><span class="p">,</span> <span class="mo">0600</span><span class="p">);</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"/sys/log"</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="o">|</span><span class="n">O_APPEND</span><span class="o">|</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0600</span><span class="p">);</span>
<span class="k">if</span> <span class="p">((</span><span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"tmpfile"</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="o">|</span><span class="n">O_CREAT</span><span class="o">|</span><span class="n">O_EXCL</span><span class="p">,</span> <span class="mo">0666</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="fopencëª°ë¼ë„ë¨">fopen.c(ëª°ë¼ë„ë¨)</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
     <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">((</span><span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_RDWR</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
     	<span class="n">printf</span><span class="p">(</span><span class="s">"íŒŒì¼ ì—´ê¸° ì˜¤ë¥˜</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
     <span class="k">else</span> <span class="n">printf</span><span class="p">(</span><span class="s">"íŒŒì¼ %s ì—´ê¸° ì„±ê³µ : %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fd</span><span class="p">);</span>
     
     <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
     <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="file-descriptor">File Descriptor</h2>

<ul>
  <li>í˜„ì¬ ì—´ë ¤ìˆëŠ” <strong>íŒŒì¼ì„ êµ¬ë¶„</strong>í•˜ëŠ” ì •ìˆ˜ê°’</li>
  <li>ì €ìˆ˜ì¤€ íŒŒì¼ ì…ì¶œë ¥ì—ì„œ <strong>ì—´ë¦° íŒŒì¼</strong>ì„ ì°¸ì¡°í•˜ëŠ”ë° ì‚¬ìš©</li>
  <li><strong>file descriptor table</strong>
    <ul>
      <li>kernalì´ ê´€ë¦¬í•˜ëŠ” ìë£Œêµ¬ì¡°</li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160038332-1cebe98f-bbb8-46b9-b0d1-482571f1fafc.png" alt="image" /></p>

<ul>
  <li>í”„ë¡œì„¸ì„œê°€ ìƒì„± ë  ë•Œ 0,1,2 indexë“¤ì€ ìë™ìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ ì£¼ì†Œê³µê°„(text, data,heap, stack)ê³¼ ë”ë¶ˆì–´ í• ë‹¹ë˜ì–´ì§„ë‹¤. (NEW state)</li>
  <li>ì²˜ìŒìœ¼ë¡œ ë¶€ì—¬ ë°›ëŠ” file descriptorëŠ” 3ë²ˆ</li>
</ul>

<hr />

<p>Q) close(fd)ë¥¼ í•˜ë©´ file descriptorê°€ ì—†ì–´ì§€ëŠ” ê²ƒì¸ê°€?(pop?)</p>

<p>A) ã…‡ã…‡ 3ë²ˆìœ¼ë¡œ ì—´ë ¸ë‹¤ê°€ closeí•˜ê³  ë˜ ì˜¤í”ˆ í•˜ë©´ 3ë²ˆì— ìƒê¹€.</p>

<hr />

<p><br /></p>

<ul>
  <li><strong>file descriptor</strong>
    <ul>
      <li>all open files are referred to by file descriptors. (<strong>not path name</strong>)</li>
      <li>how to obtain file descriptor
        <ul>
          <li>return value of <strong>open()</strong>, creat()</li>
        </ul>
      </li>
      <li>when we want to read or write a file,
        <ul>
          <li>we <strong>identify</strong> the file with the file descriptor</li>
        </ul>
      </li>
      <li>file descriptor is the <span style="color:blue">index of user file descriptor table</span>(ë°°ì—´ì˜ ì¸ë±ìŠ¤)</li>
      <li>STDIN_FILENO(0), STDOUT_FILENO(1), STDERR_FILENO(2)
        <ul>
          <li>defined in &lt;unistd.h&gt;</li>
        </ul>
      </li>
      <li>Ranged of file descriptor
        <ul>
          <li>0 ~ OPEN_MAX (<strong>63</strong> in many systems)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="íŒŒì¼-ìƒì„±-creat">íŒŒì¼ ìƒì„±: creat()</h2>

<ul>
  <li>creat() ì‹œìŠ¤í…œ í˜¸ì¶œ
    <ul>
      <li>pathê°€ ë‚˜íƒ€ë‚´ëŠ” <strong>íŒŒì¼ì„ ìƒì„±</strong>í•˜ê³  <strong>ì“°ê¸° ì „ìš©</strong>ìœ¼ë¡œ ì—°ë‹¤.</li>
      <li>ìƒì„±ëœ íŒŒì¼ì˜ <strong>ì‚¬ìš©ê¶Œí•œ</strong>ì€ <strong>mode</strong>ë¡œ ì •í•œë‹¤.</li>
      <li>ê¸°ì¡´ íŒŒì¼ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” ê·¸ ë‚´ìš©ì„ ì‚­ì œí•˜ê³  ì—°ë‹¤.(O_TRUNC)</li>
      <li>ë‹¤ìŒ ì‹œìŠ¤í…œ í˜¸ì¶œê³¼ ë™ì¼
        <ul>
          <li>
            <table>
              <tbody>
                <tr>
                  <td>open(path, WRONLY</td>
                  <td>O_CREAT</td>
                  <td>O_TRUNC, mode);</td>
                </tr>
              </tbody>
            </table>
          </li>
        </ul>
      </li>
      <li>Note that the file is opened <strong>only for writing.</strong></li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">creat</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span><span class="p">);</span>
</code></pre></div></div>

<p>íŒŒì¼ ìƒì„±ì— ì„±ê³µí•˜ë©´ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼, ì‹¤íŒ¨í•˜ë©´ -1ì„ ë¦¬í„´</p>

<p><br /></p>

<ul>
  <li>
    <p>ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©ì ì˜ì—­(user mode)ì—ì„œ êµ¬í˜„ ê°€ëŠ¥í•¨ì—ë„ creat()ëŠ” system callë¡œ ì¡´ì¬í•˜ê³  ìˆë‹¤.</p>
  </li>
  <li>
    <p>ìµœê·¼ glibcì—ì„œë„ ì œê³µ</p>

    <ul>
      <li>
        <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">creat</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">WRONLY</span> <span class="o">|</span> <span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">O_TRUNC</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>        </div>
      </li>
      <li>The <strong>GNU C Library</strong> is the GNU Projectâ€™s implementation of the C standard library.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="íŒŒì¼-ë‹«ê¸°-close">íŒŒì¼ ë‹«ê¸°: close()</h2>

<ul>
  <li>close() ì‹œìŠ¤í…œ í˜¸ì¶œì€ fdê°€ ë‚˜íƒ€ë‚´ëŠ” íŒŒì¼ì„ ë‹«ëŠ”ë‹¤.</li>
  <li>ì¢…ë£Œë˜ë©´ ì•Œì•„ì„œ OSê°€ ì¢…ë£Œ ì‹œì¼œ ì£¼ì§€ë§Œ explicitly ì¢…ë£Œ ì‹œì¼œ ì£¼ëŠ” ê²ƒì„ <strong>ê¶Œì¥</strong></li>
  <li>When a process termiantes, all of its open files are closed <strong>automatically</strong> by the kernel.
    <ul>
      <li>-&gt; Many program often do not explicily close open files.</li>
    </ul>
  </li>
  <li>On Unix-like systems, the interface defined by <strong>unistd.h</strong> is typically made up largely of <strong>system call wrapper functions</strong> such as <strong>fork, pipe</strong> and <strong>I/O</strong> primitives (read, write, close, etc.).</li>
  <li>&lt;unistd.h&gt; is the <strong>header file</strong> that provides access to the POSIX OS API</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">close</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">);</span>
<span class="c1">//fdê°€ ë‚˜íƒ€ë‚´ëŠ” íŒŒì¼ì„ ë‹«ëŠ”ë‹¤.</span>
<span class="c1">//ì„±ê³µí•˜ë©´ 0, ì‹¤íŒ¨í•˜ë©´ -1ì„ ë¦¬í„´í•œë‹¤.</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="ë°ì´í„°-ì½ê¸°-read">ë°ì´í„° ì½ê¸°: read()</h2>

<ul>
  <li>read()  ì‹œìŠ¤í…œ í˜¸ì¶œ
    <ul>
      <li>read up to nbytes from file (fd) into the buffer starting at <em>buf</em>
        <ul>
          <li>read() <strong>starts</strong> at the fileâ€™s <strong>current offset</strong>.</li>
          <li>Before a successful return, the offset is incremented by the number of bytes actually read.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="kt">ssize_t</span> <span class="nf">read</span> <span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>
<span class="c1">// fdì˜ ìœ„ì¹˜ì˜ íŒŒì¼ì„ në°”ì´íŠ¸ë§Œí¼ ì½ì–´ì„œ bufìœ„ì¹˜ë¶€í„° ì‹œì‘í•´ì„œ ì €ì¥í•˜ì—¬ ì½ëŠ”ë‹¤.</span>
<span class="c1">//íŒŒì¼ ì½ê¸°ì— ì„±ê³µí•˜ë©´ ì½ì€ ë°”ì´íŠ¸ ìˆ˜, íŒŒì¼ ëì„ ë§Œë‚˜ë©´ 0</span>
<span class="c1">//ì‹¤íŒ¨í•˜ë©´ -1ì„ ë¦¬í„´</span>
<span class="c1">//(size_t: unsigned integer)</span>
<span class="c1">//(ssize_t: signed integer)</span>
</code></pre></div></div>

<p>read ì‹œìŠ¤í…œì½œì„ ë˜ ì°¾ì•„ê°€ì„œ readí•˜ëŠ” ê²ƒì€ ê·€ì°®ê¸° ë•Œë¬¸ì— file descriptorë¡œ í•˜ëŠ” ê²ƒ.</p>

<p>í•­ìƒ n ë°”ì´íŠ¸ê°€ ì½í˜€ì§€ëŠ” ê²Œ ë³´ì¥ë˜ëŠ” ê²ƒì´ ì•„ë‹˜</p>

<p><br /></p>

<h2 id="fsizec">fsize.c</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#define BUFSIZE 512
</span>
<span class="cm">/* íŒŒì¼ í¬ê¸°ë¥¼ ê³„ì‚° í•œë‹¤.*/</span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argc</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">BUFSIZE</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
    <span class="kt">ssize_t</span> <span class="n">nread</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_RDONLY</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">perror</span><span class="p">(</span><span class="n">argc</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    
    <span class="cm">/* íŒŒì¼ì˜ ëì— ë„ë‹¬í•  ë•Œê¹Œì§€ ë°˜ë³µí•´ì„œ ì½ìœ¼ë©´ì„œ íŒŒì¼ í¬ê¸° ê³„ì‚° */</span>
    <span class="k">while</span><span class="p">((</span><span class="n">nread</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">BUFSIZE</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> 
         <span class="n">total</span> <span class="o">+=</span> <span class="n">nread</span><span class="p">;</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">"%s íŒŒì¼ í¬ê¸° : %ld ë°”ì´íŠ¸ </span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">total</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

<span class="err">}</span>
</code></pre></div></div>

<p>íŒŒì¼ì˜ í¬ê¸°ê°€ BUFSIZEë³´ë‹¤ í´ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— while loopë¥¼ ëŒë©´ì„œ bufì— copyí•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p><br /></p>

<h2 id="read">read()</h2>

<ul>
  <li>The number of bytes actually read may be less than the amount requested.</li>
  <li>ìš”êµ¬ëœ ì–‘ì˜ ë°”ì´íŠ¸ë³´ë‹¤ ëœ ì½ê²Œ ë˜ëŠ” ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
    <ul>
      <li>If <strong>the end of regular file</strong> is reached before the requested number of bytes has been read.</li>
      <li>When reading from a <strong>terminal</strong> device, up to <strong>one line</strong> is read at a time.
        <ul>
          <li>ì—”í„° í‚¤ë¥¼ ì¹˜ë©´ ë‹¤ìŒ ë¼ì¸ìœ¼ë¡œ ë„˜ì–´ê°„ë‹¤.</li>
        </ul>
      </li>
      <li>When reading from a network, <strong>buffering</strong> within the network may cause less than the requested amount to be returned.</li>
      <li>When reading from a <strong>pipe</strong>, if the pipe contains <strong>fewer bytes</strong> than requested, read will return only what is available.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="ë°ì´í„°-ì“°ê¸°-write">ë°ì´í„° ì“°ê¸°: write()</h2>

<ul>
  <li>write() ì‹œìŠ¤í…œ í˜¸ì¶œ
    <ul>
      <li>writes up to nbytes to the file referenced by filedes from the buffer starting at buf</li>
      <li>write <strong>start</strong> at the <span style="color:blue">fileâ€™s current offset.</span></li>
      <li>if O_APPEND was specified when the file was opened
        <ul>
          <li>The fileâ€™s offset is set to the <strong>end of file</strong> before write</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="kt">ssize_t</span> <span class="nf">write</span> <span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>
<span class="c1">// íŒŒì¼ì— ì“°ê¸°ë¥¼ ì„±ê³µí•˜ë©´ ì‹¤ì œ ì“°ì—¬ì§„ ë°”ì´íŠ¸ ìˆ˜ë¥¼ ë¦¬í„´í•˜ê³ , ì‹¤íŒ¨í•˜ë©´ -1ì„ ë¦¬í„´</span>
</code></pre></div></div>

<p>ì“°ê³  ì‹¶ì€ ë‚´ìš©ì€ bufì—ì„œ ì‹œì‘í•˜ì—¬ ê·¸ ë‚´ìš©ì´ ë‹´ê²¨ì ¸ ìˆëŠ”ë° bufë¶€í„° nbytes ë§Œí¼ì„ fdê°€ ê°€ë¦¬í‚¤ëŠ” íŒŒì¼ì— ì‘ì„±í•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p><br /></p>

<h2 id="copyc">copy.c</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span>
<span class="cm">/* íŒŒì¼ ë³µì‚¬ í”„ë¡œê·¸ë¨ */</span>
<span class="n">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argc</span><span class="p">[])</span>
<span class="p">{</span>
     <span class="kt">int</span> <span class="n">fd1</span><span class="p">,</span> <span class="n">fd2</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
     <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">BUFSIZ</span><span class="p">];</span>
    
     <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
     	<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">"ì‚¬ìš©ë²•: %s file1 file2</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
     <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> 
     <span class="p">}</span>
    
     <span class="k">if</span> <span class="p">((</span><span class="n">fd1</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_RDONLY</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//source íŒŒì¼</span>
         <span class="n">perror</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
         <span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
     <span class="p">}</span>
    
     <span class="k">if</span> <span class="p">((</span><span class="n">fd2</span> <span class="o">=</span><span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">O_TRUNC</span> <span class="mo">0644</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//des íŒŒì¼</span>
         <span class="n">perror</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
         <span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
     <span class="p">}</span>
    
     <span class="k">while</span> <span class="p">((</span><span class="n">n</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd1</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">BUFSIZ</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
         <span class="n">write</span><span class="p">(</span><span class="n">fd2</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span> <span class="c1">// ì½ì€ ë‚´ìš©ì„ ì“´ë‹¤.</span>
         <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="err">}</span>
</code></pre></div></div>

<hr />

<p>Q)O_APPENDë¥¼ ëª…ì‹œí•˜ì§€ ì•Šì•„ë„ íŒŒì¼ì˜ ì»¤ì„œê°€ while loopê°€ ëë‚˜ë©´ íŒŒì¼ì˜ ì²˜ìŒì— ê°€ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼ end of fileì— ê°€ ìˆëŠ” ê²ƒì¸ê°€?</p>

<p>A) O_APPENDëŠ” íŒŒì¼ì„ ì—´ ë•Œ ëª…ì‹œí•˜ëŠ” ê²ƒìœ¼ë¡œ íŒŒì¼ì„ ì½ê±°ë‚˜ ì“°ë©´ íŒŒì¼ì˜ ì»¤ì„œëŠ” í•´ë‹¹ ìœ„ì¹˜ë¡œ ì˜®ê²¨ì ¸ì„œ ë‹¤ì‹œ ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤ë©´ íŒŒì¼ì´ ë‹«í ë•Œê¹Œì§€ ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤.</p>

<hr />

<p><br /></p>

<h2 id="íŒŒì¼-ë””ìŠ¤í¬ë¦½í„°-ë³µì œ">íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° ë³µì œ</h2>

<ul>
  <li>dup()/dup2() í˜¸ì¶œì€ ê¸°ì¡´ì˜ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ ë³µì œí•œë‹¤.</li>
  <li>ê¸°ì¡´ì˜ file descriptorê°€ ê°€ë¦¬í‚¤ë˜ íŒŒì¼ì„ ê°™ì´ ê°€ë¦¬í‚¤ëŠ” file descriptorë¥¼ í•˜ë‚˜ ë” ë§Œë“œëŠ” ê¸°ëŠ¥</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">dup</span><span class="p">(</span><span class="kt">int</span> <span class="n">oldfd</span><span class="p">);</span>
<span class="c1">//oldfdì— ëŒ€í•œ ë³µì œë³¸ì¸ ìƒˆë¡œìš´ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•œë‹¤.</span>
<span class="c1">//ì‹¤íŒ¨í•˜ë©´ â€“1ì„ ë°˜í™˜í•œë‹¤.</span>

<span class="kt">int</span> <span class="nf">dup2</span><span class="p">(</span><span class="kt">int</span> <span class="n">oldfd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">newfd</span><span class="p">);</span>
<span class="c1">//oldfdì„ newfdì— ë³µì œí•˜ê³  ë³µì œëœ ìƒˆë¡œìš´ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ ë°˜í™˜í•˜ê³  ì‹¤íŒ¨í•˜ë©´ -1ì„ ë°˜í™˜í•œë‹¤.</span>
</code></pre></div></div>

<p>Q) ì™œ fd2 = fd1 ìœ¼ë¡œ í•˜ë©´ ì•ˆ ë˜ì§€?</p>

<p>A) ë°”ë¡œ ì•„ë˜ì— ë‚˜ì˜´</p>

<ul>
  <li>ì €ë ‡ê²Œ í•˜ë©´ file descriptorë¥¼ í•˜ë‚˜ ë” ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤. ë¬¼ë¡  ì ‘ê·¼ì€ í•  ìˆ˜ ìˆê² ë‹¤ë§Œì€â€¦</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160048835-3ebc0fba-5591-40f4-be32-2e5194e0f1b7.png" alt="image" /></p>

<p><br /></p>

<h2 id="dup-and-dup2">dup() and dup2()</h2>

<ul>
  <li>
    <p><mark>ì‹¤ì œë¡œëŠ” dup()ê°€ oldfdë¥¼ ë°˜í™˜í•´ ì£¼ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ kernel ì•ˆì—ì„œ kernal data structureì— ëŒ€í•œ ìˆ˜ì •ì´ ì¼ì–´ë‚œë‹¤.</mark></p>
  </li>
  <li>
    <p>Kernel data structures after â€œdup(1)â€</p>
    <ul>
      <li>The next available descriptor is 3.</li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160048908-a84b4359-ab19-4a2e-8cf5-ba7fbe7e80db.png" alt="image" /></p>

<ul>
  <li>
    <p><strong>Example</strong> (ì¤‘ìš”)</p>

    <ul>
      <li>
        <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
        
    <span class="n">fd</span> <span class="o">=</span> <span class="n">creat</span><span class="p">(</span><span class="s">"dup_result"</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span> <span class="c1">// fd = 3</span>
    <span class="n">dup2</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">STDOUT_FILENO</span><span class="p">);</span> <span class="c1">// STDOUT_FILENO = fd</span>
        
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
        
    <span class="n">printf</span><span class="p">(</span><span class="s">"hello world</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>        </div>

        <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./a.out
    
<span class="err">$</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160264508-f23f7616-14bc-4c15-8fc4-0232f2217165.png" alt="image" /></p>

<p>ì•„ë¬´ ê²ƒë„ ì‹¤í–‰ì´ ë˜ì§€ ì•ŠëŠ”ë° ì´ëŠ” STDOUT_FILENO ì¦‰, í‘œì¤€ íŒŒì¼ ì¶œë ¥ descriptorë¥¼ fdê°€ ê°€ë¦¬í‚¤ëŠ” fileë¡œ í¬ì¸íŒ…ì„ ë°”ê¾¸ì–´ í‘œì¤€ ì¶œë ¥ì„ í•˜ì§€ ëª»í•´ printf() ê°€ ì‘ë™í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p>

<p><br /></p>

<ul>
  <li>
    <p>ì‹¤í–‰</p>

    <ul>
      <li>
        <pre><code class="language-assembly">$ cat dup_result
hello world
</code></pre>
      </li>
    </ul>
  </li>
</ul>

<p>íŒŒì¼ì„ STDOUT tableì— ë³µì œë¥¼ í•˜ì—¬ í‘œì¤€ ì¶œë ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë˜ê³  ì½”ë“œì˜ ê²°ê³¼ì¸ printfê°€ ì‹¤í–‰ë˜ì§€ ëª»í•  ê²ƒì´ë‹¤.</p>

<p>ê·¸ë˜ì„œ ë§Œì•½ ì¶œë ¥ì„ í•˜ê³  ì‹¶ìœ¼ë©´ cat ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.</p>

<ul>
  <li>íŒŒì¼ ì¶œë ¥ì€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì—</li>
</ul>

<p>ê·¸ë˜ì„œ ëª¨ë‹ˆí„°ì— ì¶œë ¥ ëœ ê²ƒì´ ì•„ë‹ˆë¼ íŒŒì¼ì— ì¶œë ¥ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<h2 id="dupc">dup.c</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">fd1</span><span class="p">,</span> <span class="n">fd2</span><span class="p">;</span>

    <span class="k">if</span><span class="p">((</span><span class="n">fd1</span> <span class="o">=</span> <span class="n">creat</span><span class="p">(</span><span class="s">"myfile"</span><span class="p">,</span> <span class="mo">0600</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    	<span class="n">perror</span><span class="p">(</span><span class="s">"myfile"</span><span class="p">);</span>

    <span class="n">write</span><span class="p">(</span><span class="n">fd1</span><span class="p">,</span> <span class="s">"Hello! Linux"</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
    <span class="n">fd2</span> <span class="o">=</span> <span class="n">dup</span><span class="p">(</span><span class="n">fd1</span><span class="p">);</span>
    <span class="n">write</span><span class="p">(</span><span class="n">fd2</span><span class="p">,</span> <span class="s">"Bye! Linux"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dup
<span class="nv">$ </span><span class="nb">cat </span>myfile
Hello! LinuxBye! Linux
</code></pre></div></div>

<p>fd1ê³¼ fd1ì„ duplicateí•œ fd2ëŠ” ê°™ì€ íŒŒì¼ì„ ê°€ë¦¬í‚¤ê¸° ë•Œë¬¸ì— ë‘ íŒŒì¼ì´ ì´ì–´ì ¸ì„œ ì‘ì„±ì´ ë˜ì—ˆë‹¤.</p>

<p><br /></p>

<h2 id="sync-fsync-and-fdatasync">sync(), fsync(), and fdatasync()</h2>

<p>dataë¥¼ íŒŒì¼ì— writeí•  ë•Œ í•˜ë“œë””ìŠ¤í¬ì— ì§ì ‘ ì“°ë©´ ì†ë„ê°€ ë§¤ìš° ëŠë¦¬ë‹¤.</p>

<p>ê·¸ë˜ì„œ ì§ì ‘ ì“°ì—¬ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ (ë„ˆë¬´ ì˜¤ë˜ê±¸ë¦¬ê¸° ë•Œë¬¸ì—) buffer cacheì— ì¨ë‘ì—ˆë‹¤ê°€ ë‚˜ì¤‘ì— ì‚¬ìš©ë˜ê²Œ í•œë‹¤.(daemonì— ì˜í•´ì„œ ì£¼ê¸°ì ìœ¼ë¡œ updateëœë‹¤.)</p>

<p>CPU-M.M ì€ ë°©ì‹ì´ ë‹¤ë¥´ë‹¤ CPUì™€ M.M ì‚¬ì´ì— ìˆëŠ” cacheëŠ” ì½ê¸° ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒì´ë‹¤. (writeëŠ” cacheë¡œ ë™ì‘ë˜ì§€ ì•Šê³  ë°”ë¡œ memoryì— ì“°ì—¬ì§„ë‹¤.)</p>

<ul>
  <li><strong>Delayed write</strong>
    <ul>
      <li>When write data to a file, the data is copied into buffers.
        <ul>
          <li>fileì— ë°ì´í„°ê°€ write ë  ë•Œ fileì— ì“°ì—¬ì§€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ bufferì— ì“°ì—¬ì§€ëŠ” ê²ƒì´ë‹¤.</li>
        </ul>
      </li>
      <li>The data is physically written to disk at some later time.(ë””ìŠ¤í¬ì—ëŠ” ë‚˜ì¤‘ì— ì“°ì—¬ì§)</li>
      <li>ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ  -&gt; ë™ì¼í•œ ë°ì´í„°ì— ëŒ€í•œ ì—°ì†ì ì¸ read/writeì‹œ <strong>ì„±ëŠ¥ í–¥ìƒ</strong>.(I/O ì„±ëŠ¥ í–¥ìƒ)</li>
    </ul>
  </li>
  <li>When the <strong>delayed-write</strong> blocks are written to disk?
    <ul>
      <li>Buffer is filled with the delayed-write blocks or</li>
      <li>Periodically by update <strong>daemon</strong> (usually every 30 seconds)</li>
      <li><mark>ì´ ì£¼ê¸°ë³´ë‹¤ ë¹ ë¥¸ ì£¼ê¸°ë¡œ ë°˜ì˜í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ sync()</mark>
        <ul>
          <li>ë°˜ì˜ì´ë¼ëŠ” ë§ì´ â€˜key wordâ€™</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">fsync</span><span class="p">(</span><span class="kt">int</span> <span class="n">filedes</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">fdatasync</span><span class="p">(</span><span class="kt">int</span> <span class="n">filedes</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">sync</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
 
<span class="c1">//Returns: 0 if OK, -1 on error</span>
</code></pre></div></div>

<ul>
  <li>sync()
    <ul>
      <li>ë¦¬í„´ íƒ€ì…ì´ void : í•­ìƒ ì„±ê³µì„ ë³´ì¥í•œë‹¤ëŠ” ì˜ë¯¸</li>
      <li>Write <strong>all</strong> the modified buffer blocks to disk.</li>
      <li>íŒŒì¼ì— ê´€ê³„ì—†ì´ ë°”ë¡œ ë””ìŠ¤í¬ì— ì¨ë¼, (buffer cacheì— ìˆëŠ” ìˆ˜ì •ëœ)ëª¨ë“  modified buffer blocksì„ ë””ìŠ¤í¬ì— ì“°ì—¬ì§.
        <ul>
          <li>ê·¼ë° ì´ê±°ëŠ” <strong>ëª¨ë“ </strong> modifies blockì„ writeí•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— êµ‰ì¥íˆ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ê°€ ìˆëŠ”ë°</li>
          <li>1ë°”ì´íŠ¸ ë‹¨ìœ„ê°€ ì•„ë‹ˆë¼ í•œ ë²ˆ ë°ì´í„°ë¥¼ ê°€ì ¸ê°€ëŸ¬ ê°”ì„ ë•Œ ê·¸ ê·¼ì²˜ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ë‹¤ ê°€ì ¸ì˜¨ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ëŠ” block ë‹¨ìœ„ë¡œ ê°€ì ¸ì˜´</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>fsync()
    <ul>
      <li>Write only the modified (<strong>data + attribute</strong>) buffer blocks of a single file.</li>
      <li>data block + attribute block</li>
      <li>íŠ¹ì • íŒŒì¼ì— ëŒ€í•´ì„œë§Œ write (<strong>íŠ¹íˆ file descriptorì™€ ê´€ë ¨ëœ ê²ƒë“¤</strong>)</li>
    </ul>
  </li>
  <li>fdatasync()
    <ul>
      <li>Write <strong>only</strong> the modified <strong>data</strong> buffer blocks of a single file.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="fcntl">fcntl()</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">fcntl</span><span class="p">(</span><span class="kt">int</span> <span class="n">filedes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="p">...</span><span class="cm">/*int arg*/</span><span class="p">);</span> <span class="c1">// filedes:íŒŒì¼ë””ìŠ¤í¬ë¦½í„°, cmd: ì»¤ë§¨ë“œ</span>
<span class="c1">//Return: depends on cmd if OK (see following), -1 on error</span>
</code></pre></div></div>

<ul>
  <li>
    <p>íŒŒì¼ ì»¨íŠ¸ë¡¤ í•  ë•Œ ëŒ€ìƒ íŒŒì¼ì— ëŒ€í•´ì„œ ì»¤ë§¨ë“œëŒ€ë¡œ <strong>íŒŒì¼ íŠ¹ì„±ì„ ë³€ê²½</strong>í•´ë‹¬ë¼ëŠ” ëª…ë ¹ì–´</p>
  </li>
  <li>Change the properties of a file that is <strong>already open</strong>
    <ul>
      <li>Duplicate an existing desciptor (cmd = F_DUPFD)</li>
      <li>Get/set file descriptor flags (cmd = F_GETFD or F_SETFD)</li>
      <li>Get/set file status flags (cmd = F_GETFL or F_SETFL)</li>
      <li>Get/set asynchronous I/O ownership (cmd = F_GETOWN or F_SETOWN)</li>
      <li>Get/set record <strong>locks</strong> (cmd = F_GETLK, F_SETLK, or F_SETLKW)</li>
    </ul>
  </li>
  <li>example</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* include header files ìƒëµ */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
     <span class="kt">int</span> <span class="n">mode</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">value</span><span class="p">;</span>
    
     <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"test.sh"</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="o">|</span><span class="n">O_CREAT</span><span class="p">);</span>
     <span class="n">value</span> <span class="o">=</span> <span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">F_GETFL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//status flag ì½ì–´ì˜¤ê¸° -&gt; valueì— ì €ì¥</span>
    
     <span class="n">mode</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="n">O_ACCMODE</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">O_RDONLY</span><span class="p">)</span>
     	<span class="n">printf</span><span class="p">(</span><span class="s">"O_RDONLY setting</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
     <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">O_WRONLY</span><span class="p">)</span>
     	<span class="n">printf</span><span class="p">(</span><span class="s">"O_WRONLY setting</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
     <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">O_RDWR</span><span class="p">)</span>
     	<span class="n">printf</span><span class="p">(</span><span class="s">"O_RDWR setting</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>ì‹¤í–‰</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ./fgetfl_test</span>
O_RDONLY setting
<span class="nv">$ </span>
</code></pre></div></div>

<p>open í•  ë•Œ RDONLYë¡œ ì—´ì–´ì„œ ìœ„ì™€ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜´</p>

<ul>
  <li>Macro: int <strong>O_ACCMODE</strong>
    <ul>
      <li>This macro stands for <strong>a mask</strong> that can be <mark>bitwise-ANDed</mark> with <strong>the file status flag</strong> value to produce a value representing the file access mode. The mode will be O_RDONLY, O_WRONLY, or O_RDWR.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h1 id="43-ì„ì˜-ì ‘ê·¼-íŒŒì¼">4.3 ì„ì˜ ì ‘ê·¼ íŒŒì¼</h1>

<h2 id="íŒŒì¼-ìœ„ì¹˜-í¬ì¸í„°file-position-pointer">íŒŒì¼ ìœ„ì¹˜ í¬ì¸í„°(file position pointer)</h2>

<ul>
  <li>íŒŒì¼ ìœ„ì¹˜ í¬ì¸í„°ëŠ” íŒŒì¼ ë‚´ì— ì½ê±°ë‚˜ ì“¸ ìœ„ì¹˜ì¸ í˜„ì¬ íŒŒì¼ ìœ„ì¹˜(currnet file position)ë¥¼ ê°€ë¦¬í‚¨ë‹¤.</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160050554-ecab5614-966a-4c0b-958c-378b86764516.png" alt="image" /></p>

<p><br /></p>

<h2 id="íŒŒì¼-ìœ„ì¹˜-í¬ì¸í„°-ì´ë™-lseek">íŒŒì¼ ìœ„ì¹˜ í¬ì¸í„° ì´ë™: lseek()</h2>

<ul>
  <li>lseek() ì‹œìŠ¤í…œ í˜¸ì¶œ
    <ul>
      <li><strong>ì„ì˜ì˜ ìœ„ì¹˜ë¡œ</strong> íŒŒì¼ ìœ„ì¹˜ í¬ì¸í„°ë¥¼ ì´ë™ì‹œí‚¬ ìˆ˜ ìˆë‹¤.</li>
      <li>The offset for regular files must be non-negative</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="kt">off_t</span> <span class="nf">lseek</span> <span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">off_t</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">whence</span><span class="p">);</span> <span class="c1">//whence:ê¸°ì¤€ì </span>
<span class="c1">//ì´ë™ì— ì„±ê³µí•˜ë©´ í˜„ì¬ ìœ„ì¹˜(measured in bytes from the beginning of the file)ë¥¼ ë¦¬í„´í•˜ê³  ì‹¤íŒ¨í•˜ë©´ -1ì„ ë¦¬í„´í•œë‹¤.</span>
</code></pre></div></div>

<ul>
  <li>off_t: ë¦¬ëˆ…ìŠ¤ë‚˜ cì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° íƒ€ì… (ì˜ë¯¸ë¥¼ ë¶€ì—¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° íƒ€ì…)</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160050692-1709068a-0b5c-49c5-9e2b-d6b522c1c0d8.png" alt="image" /></p>

<p><br /></p>

<p><strong>lseek()</strong></p>

<ul>
  <li>whence
    <ul>
      <li>SEEK_SET
        <ul>
          <li>The offset is set to offset bytes from <strong>the beginning of the file.</strong></li>
        </ul>
      </li>
      <li>SEEK_CUR
        <ul>
          <li>The offset is set to <strong>its current location</strong> plus offset bytes.</li>
        </ul>
      </li>
      <li>SEEK_END
        <ul>
          <li>The offset is set to <strong>the size of the file</strong> plus offset bytes.(íŒŒì¼ì˜ ë§ˆì§€ë§‰)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h2 id="íŒŒì¼-ìœ„ì¹˜-í¬ì¸í„°ì´ë™-ì˜ˆ">íŒŒì¼ ìœ„ì¹˜ í¬ì¸í„°ì´ë™: ì˜ˆ</h2>

<ul>
  <li>íŒŒì¼ ìœ„ì¹˜ ì´ë™
    <ul>
      <li>lseek(fd, 0L, SEEK_SET);  // íŒŒì¼ ì‹œì‘ìœ¼ë¡œ ì´ë™(rewind)</li>
      <li>lseek(fd, 100L, SEEK_SET); // íŒŒì¼ ì‹œì‘ì—ì„œ 100ë°”ì´íŠ¸ ìœ„ì¹˜ë¡œ</li>
      <li>lseek(fd, 0L, SEEK_END); //íŒŒì¼ ëìœ¼ë¡œ ì´ë™ (ì¼ì¢…ì˜ append í•˜ê¸° ìœ„í•œ í–‰ë™)</li>
      <li>lseek(fd, 100L, SEEK_CUR); //í˜„ì¬ìœ„ì¹˜ì—ì„œ 100ë°”ì´íŠ¸ ì´ë™</li>
    </ul>
  </li>
  <li>ë ˆì½”ë“œ ë‹¨ìœ„ë¡œ ì´ë™ (ë ˆì½”ë“œ êµ¬ì¡°ì²´ì˜ sizeë§Œí¼ ì´ë™í•œë‹¤.)
    <ul>
      <li>lseek(fd, n * sizeof(record), SEEK_SET); //n+1ë²ˆì§¸ ë ˆì½”ë“œ ì‹œì‘ìœ„ì¹˜ë¡œ</li>
      <li>lseek(fd, sizeof(record), SEEK_CUR); //ë‹¤ìŒ ë ˆì½”ë“œ ì‹œì‘ìœ„ì¹˜ë¡œ</li>
      <li>lseek(fd, -sizeof(record), SEEK_CUR); // ì „ ë ˆì½”ë“œ ì‹œì‘ìœ„ì¹˜ë¡œ</li>
    </ul>
  </li>
  <li>íŒŒì¼ ë ì´í›„ë¡œ ì´ë™
    <ul>
      <li>lseek(fd, sizeof(record), SEEK_END);  //íŒŒì¼ ëì—ì„œ í•œ ë ˆì½”ë“œ ë‹¤ìŒ ìœ„ì¹˜ë¡œ
        <ul>
          <li>ë¹ˆ ê³µê°„ì„ ì˜ë¯¸í•˜ëŠ” holeì´ ë°œìƒí•¨.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><br /></p>

<p><strong>hole</strong></p>

<ul>
  <li>The fileâ€™s offset can be greater than the fileâ€™s size.
    <ul>
      <li>offsetì€ file sizeë³´ë‹¤ ì»¤ë„ ìƒê´€ì—†ë‹¤.</li>
      <li>Next write to the file will extend the file.</li>
    </ul>
  </li>
  <li>It means that a <strong>hole</strong> in file is created and is allowed.</li>
  <li>read from the data in hole <strong>returns 0</strong>.</li>
</ul>

<p><img src="https://user-images.githubusercontent.com/79521972/160264881-a319ead0-778c-429b-96b0-414dafdb177d.png" alt="image" /></p>

<ul>
  <li>
    <p><strong>example</strong></p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"apue.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span>  
<span class="kt">char</span> <span class="n">buf1</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"abcdefghij"</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">buf2</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"ABCDEFGHIJ"</span><span class="p">;</span>
  
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
      
    <span class="k">if</span> <span class="p">((</span><span class="n">fd</span> <span class="o">=</span> <span class="n">creat</span><span class="p">(</span><span class="s">"file.hole"</span><span class="p">,</span> <span class="n">FILE_MODE</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
   		<span class="n">err_sys</span><span class="p">(</span><span class="s">"creat error"</span><span class="p">);</span>
    <span class="cm">/* FILE_MODE is defined as 644 in â€œapue.hâ€.; rw-r--r--*/</span>
    <span class="cm">/* offset now = 0 */</span>
      
    <span class="k">if</span> <span class="p">(</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">)</span>
    	<span class="n">err_sys</span><span class="p">(</span><span class="s">"buf1 write error"</span><span class="p">);</span>
    <span class="cm">/* offset now = 10 */</span>
      
    <span class="k">if</span> <span class="p">(</span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mi">16384</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1">//16374 ë§Œí¼ì˜ holeì´ ìƒì„±ë¨.</span>
    	<span class="n">err_sys</span><span class="p">(</span><span class="s">"lseek error"</span><span class="p">);</span>
    <span class="cm">/* offset now = 16384 */</span>
      
    <span class="k">if</span> <span class="p">(</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">// hole ë’¤ì— write</span>
    	<span class="n">err_sys</span><span class="p">(</span><span class="s">"buf2 write error"</span><span class="p">);</span>
    <span class="cm">/* offset now = 16394 */</span>
      
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ì‹¤í–‰ ì˜ˆ</p>
  </li>
  <li>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./a.out
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> file.hole 	check its size
<span class="nt">-rw-r--r--</span> 1 sar	16394 Nov 25 01:01 file.hole <span class="c"># file size : 0~16393  -&gt; 16394 bytes</span>
<span class="nv">$ </span><span class="nb">od</span> <span class="nt">-c</span> file.hole	<span class="nb">let</span><span class="s1">'s look at the actual contents
0000000 a b c d e f g h i j \0 \0 \0 \0 \0 \0
0000020 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0 \0
*
0040000 A B C D E F G H I J  //16384 = 40000(8)
0040012						//16394 = 40012(8)
</span></code></pre></div>    </div>
  </li>
  <li>
    <blockquote>
      <p>od utility: dump files in octal.(8ì§„ìˆ˜ë¡œ fileì„ dump)</p>

      <p>â€‹              -c: print the contents as characters.</p>
    </blockquote>
  </li>
</ul>

<p><br /></p>

<ul>
  <li>
    <p><mark>Are the disk blocks allocated for hole?</mark></p>

    <ul>
      <li>holeë„ í•˜ë“œë””ìŠ¤í¬ê°€ í• ë‹¹ë ê¹Œ?</li>
    </ul>
  </li>
  <li>
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ls</span> file.hole file.nohole
 	8 <span class="nt">-rw-r--r--</span> 1 sar 			16394 Nov 25 01:01 file.hole
 	20 <span class="nt">-rw-r--r--</span> 1 sar 		16394 Nov 25 01:03 file.nohole
</code></pre></div>    </div>
  </li>
  <li>
    <p>Compare the sizes of file.hole and file.nohole</p>

    <ul>
      <li>file.hole: with hole
        <ul>
          <li>8 blocks are allocated.</li>
          <li>so, <span style="color:red">í•˜ë“œë””ìŠ¤í¬ì˜ ê³µê°„ì„ ì°¨ì§€í•˜ì§€ ì•ŠëŠ”ë‹¤.</span></li>
        </ul>
      </li>
      <li>file.nohole: a file of the same size, but without holes.
        <ul>
          <li>20 blocks are allocated.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>ls utility</p>

  <p>-s: with -l, print size of each file, in blocks.</p>

  <p>-së¥¼ í¬í•¨ì‹œì¼œì„œ block ìˆ˜ê°€ ë‚˜ì˜¨ ê²ƒì´ë‹¤.</p>
</blockquote>

<p><br /></p>

<h2 id="ë ˆì½”ë“œ-ì €ì¥-ì˜ˆ">ë ˆì½”ë“œ ì €ì¥ ì˜ˆ</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">record1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">));</span>
<span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">record2</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">));</span>
<span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">SEEK_END</span><span class="p">);</span> 
<span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">record3</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">));</span> <span class="c1">//hole ìƒì„±</span>
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/79521972/160264999-adc81c14-0c9e-48ef-b0f1-914ad46162d5.png" alt="image" /></p>

<p><br /></p>

<h2 id="dbcreatec">dbcreate.c</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"student.h"</span><span class="cp">
</span>
<span class="cm">/* í•™ìƒ ì •ë³´ë¥¼ ì…ë ¥ë°›ì•„ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì— ì €ì¥í•œë‹¤. */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">student</span> <span class="n">record</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    	<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"ì‚¬ìš©ë²• : %s file</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    	<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">((</span><span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_WRONLY</span><span class="o">|</span><span class="n">O_CREAT</span><span class="o">|</span><span class="n">O_EXCL</span><span class="p">,</span> <span class="mo">0640</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    	<span class="n">perror</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    	<span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%-9s %-8s %-4s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"í•™ë²ˆ"</span><span class="p">,</span> <span class="s">"ì´ë¦„"</span><span class="p">,</span> <span class="s">"ì ìˆ˜"</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d %s %d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">record</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">record</span><span class="p">.</span><span class="n">score</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">id</span> <span class="o">-</span> <span class="n">START_ID</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">SEEK_SET</span><span class="p">);</span>
        <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">record</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>í•™ìƒì˜ í•™ë²ˆì— ë”°ë¼ í•´ë‹¹ í•™ìƒì˜ ì •ë³´ê°€ ì €ì¥ë  ë ˆì½”ë“œ ì£¼ì†Œê°€ ë¶€ì—¬ë˜ê³  ê·¸ ì£¼ì†Œë¡œ ê°€ì„œ ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ì„œëŠ” í•™ìƒì˜ idì—ì„œ START_IDë¥¼ ëº€ ê°’ì— ë ˆì½”ë“œ í¬ê¸°ë¥¼ ê³±í•˜ì—¬ ì´ë™ í•œë’¤ì— ì •ë³´ë¥¼ ì‘ì„±í•˜ë©´ ê·¸ ì „ì— ìˆëŠ” í•™ìƒë“¤ì˜ ê³µê°„ì„ ì¹¨í•´í•˜ì§€ ì•Šê³  (ì¦‰, ê·¸ ê³µê°„ë“¤ì€ holeë¡œ ë‚¨ê²¨ ë‘” ì±„) í•´ë‹¹ í•™ìƒì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ê²Œ ëœë‹¤.</p>

<p><br /></p>

<h2 id="studenth">student.h</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define MAX 24
#define START_ID 1401001 //í•™ìƒë“¤ì´ ë¶€ì—¬ ë°›ëŠ” í•™ë²ˆ ì¤‘ì—ì„œ ê°€ì¥ ì‘ì€ ê°’
</span><span class="k">struct</span> <span class="n">student</span> <span class="p">{</span>
 <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="n">MAX</span><span class="p">];</span>
 <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
 <span class="kt">int</span> <span class="n">score</span><span class="p">;</span>
<span class="p">};</span>

</code></pre></div></div>

<p><br /></p>

<hr />

<h2 id="dbqueryc">dbquery.c</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"student.h"</span><span class="cp">
</span>
<span class="cm">/* í•™ë²ˆì„ ì…ë ¥ë°›ì•„ í•´ë‹¹ í•™ìƒì˜ ë ˆì½”ë“œë¥¼ íŒŒì¼ì—ì„œ ì½ì–´ ì¶œë ¥í•œë‹¤. */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">student</span> <span class="n">record</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"ì‚¬ìš©ë²• : %s file</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_RDONLY</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">ê²€ìƒ‰í•  í•™ìƒì˜ í•™ë²ˆ ì…ë ¥:"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="n">id</span><span class="o">-</span><span class="n">START_ID</span><span class="p">)</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">SEEK_SET</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">record</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"ì´ë¦„:%s</span><span class="se">\t</span><span class="s"> í•™ë²ˆ:%d</span><span class="se">\t</span><span class="s"> ì ìˆ˜:%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">score</span><span class="p">);</span>
            <span class="k">else</span> <span class="n">printf</span><span class="p">(</span><span class="s">"ë ˆì½”ë“œ %d ì—†ìŒ</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="n">printf</span><span class="p">(</span><span class="s">"ì…ë ¥ ì˜¤ë¥˜"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"ê³„ì†í•˜ê² ìŠµë‹ˆê¹Œ?(Y/N)"</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">" %c"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="sc">'Y'</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Q) if (scanf(â€œ%dâ€, &amp;id) == 1)  -&gt;  ì´ê²Œ ë¬´ìŠ¨ ëœ»ì´ì§€?</p>

<p>A) scanfì˜ ì…ë ¥ ì¸ìê°€ 1ì´ë©´ ì¦‰, ìˆ«ì í•œ ê°œë¥¼ ì œëŒ€ë¡œ ì…ë ¥ ë°›ì•˜ìœ¼ë©´ ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ì˜ë¯¸</p>

<ul>
  <li>ë„ì–´ì“°ê¸°ê°€ ì—†ì´ ì…ë ¥ì„ ì˜ ë°›ì•˜ë‹¤ëŠ” ëœ»</li>
</ul>

<h2 id="ë ˆì½”ë“œ-ìˆ˜ì •-ê³¼ì •">ë ˆì½”ë“œ ìˆ˜ì • ê³¼ì •</h2>

<ol>
  <li>íŒŒì¼ë¡œë¶€í„° í•´ë‹¹ ë ˆì½”ë“œë¥¼ ì½ì–´ì„œ</li>
  <li>ì´ ë ˆì½”ë“œë¥¼ ìˆ˜ì •í•œ í›„ì—</li>
  <li>ìˆ˜ì •ëœ ë ˆì½”ë“œë¥¼ ë‹¤ì‹œ íŒŒì¼ ë‚´ì˜ ì›ë˜ ìœ„ì¹˜ì— ì¨ì•¼ í•œë‹¤.</li>
</ol>

<p>ì¦‰, ë–¼ì–´ë‚´ì„œ ìˆ˜ì •í•˜ê³  ë‹¤ì‹œ ë¶™ì—¬ë„£ëŠ” ì‹</p>

<p><br /></p>

<h2 id="ë ˆì½”ë“œ-ìˆ˜ì •">ë ˆì½”ë“œ ìˆ˜ì •</h2>

<p><img src="https://user-images.githubusercontent.com/79521972/160265080-abf6cdea-96d0-4a5e-b4e1-61ef296269b9.png" alt="image" /></p>

<p>ìˆ˜ì •ëœ ê±¸ ë‹¤ì‹œ ëŒë ¤ë†“ê¸° ìœ„í•´ì„œ lseekë¥¼ 2ë²ˆ í•´ì•¼í•¨</p>

<p><br /></p>

<h2 id="dbupdatec">dbupdate.c</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"student.h"</span><span class="cp">
</span>
<span class="cm">/* í•™ë²ˆì„ ì…ë ¥ë°›ì•„ í•´ë‹¹ í•™ìƒ ë ˆì½”ë“œë¥¼ ìˆ˜ì •í•œë‹¤. */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">id</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">student</span> <span class="n">record</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"ì‚¬ìš©ë²• : %s file</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_RDWR</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"ìˆ˜ì •í•  í•™ìƒì˜ í•™ë²ˆ ì…ë ¥: "</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="p">(</span><span class="n">id</span><span class="o">-</span><span class="n">START_ID</span><span class="p">)</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">SEEK_SET</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">record</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"í•™ë²ˆ:%8d</span><span class="se">\t</span><span class="s"> ì´ë¦„:%4s</span><span class="se">\t</span><span class="s"> ì ìˆ˜:%4d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">record</span><span class="p">.</span><span class="n">score</span><span class="p">);</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">"ìƒˆë¡œìš´ ì ìˆ˜: "</span><span class="p">);</span>
                <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">record</span><span class="p">.</span><span class="n">score</span><span class="p">);</span>
                <span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="o">-</span><span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">SEEK_CUR</span><span class="p">);</span> <span class="c1">//í•™ìƒ ë ˆì½”ë“œì˜ ì²˜ìŒ ìœ„ì¹˜ë¡œ ëŒì•„ê°</span>
                <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">record</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">record</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">else</span> <span class="n">printf</span><span class="p">(</span><span class="s">"ë ˆì½”ë“œ %d ì—†ìŒ</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="n">printf</span><span class="p">(</span><span class="s">"ì…ë ¥ì˜¤ë¥˜</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"ê³„ì†í•˜ê² ìŠµë‹ˆê¹Œ?(Y/N)"</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">" %c"</span><span class="p">,</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'Y'</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p><br /></p>

<h2 id="í•µì‹¬-ê°œë…">í•µì‹¬ ê°œë…</h2>

<ul>
  <li>ì‹œìŠ¤í…œ í˜¸ì¶œì€ ì»¤ë„ì— ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•˜ê¸° ìœ„í•œ í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´ìŠ¤ë¡œ ì‘ìš© í”„ë¡œê·¸ë¨ì€ ì‹œìŠ¤í…œ í˜¸ì¶œì„ í†µí•´ì„œ ì»¤ë„ì— ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆë‹¤.</li>
  <li>íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ëŠ” ì—´ë¦° íŒŒì¼ì„ ë‚˜íƒ€ë‚´ëŠ” ì •ìˆ˜ê°’ì„ ì˜ë¯¸í•œë‹¤.</li>
  <li>open() ì‹œìŠ¤í…œ í˜¸ì¶œì„ íŒŒì¼ì„ ì—´ê³  ì—´ë¦° íŒŒì¼ì˜ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ ë°˜í™˜í•œë‹¤.</li>
  <li>read() ì‹œìŠ¤í…œ í˜¸ì¶œì€ ì§€ì •ëœ íŒŒì¼ì—ì„œ ì›í•˜ëŠ” ë§Œí¼ì˜ ë°ì´í„°ë¥¼ ì½ê³  
write() ì‹œìŠ¤í…œ í˜¸ì¶œì€ ì§€ì •ëœ íŒŒì¼ì— ì›í•˜ëŠ” ë§Œí¼ì˜ ë°ì´í„°ë¥¼ ì“´ë‹¤.</li>
  <li>íŒŒì¼ ìœ„ì¹˜ í¬ì¸í„°ëŠ” íŒŒì¼ ë‚´ì— ì½ê±°ë‚˜ ì“¸ ìœ„ì¹˜ì¸ í˜„ì¬ íŒŒì¼ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¨ë‹¤. (ì»¤ì„œ ì—­í• )</li>
  <li>lseek() ì‹œìŠ¤í…œ í˜¸ì¶œì€ ì§€ì •ëœ íŒŒì¼ì˜ í˜„ì¬ íŒŒì¼ ìœ„ì¹˜ë¥¼ ì›í•˜ëŠ” ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚¨ë‹¤</li>
</ul>

:ET